&НаСервере
Процедура Расш1_ПередЗаписьюНаСервереПеред(Отказ, ТекущийОбъект, ПараметрыЗаписи)
	// +ФК MF_Задача №2 30.09.2021  В справочнике Контрагенты убрать проверку наличия присоединенных файлов при записи
	Возврат;
	// -ФК MF_Задача №2 30.09.2021  В справочнике Контрагенты убрать проверку наличия присоединенных файлов при записи
	// Проверка документов
	фкПроверитьВидыДокументов(Отказ,ТекущийОбъект);	
	
КонецПроцедуры

Внешняя печатная для Маршрутного листа Заявка Перевозчика
		// +ФК MF_Задача №3 30.09.2021 Ошибка вывода формы печати: получение файлов факсимилек
		
		// MF уатОбщегоНазначения.ЗаполнитьФаксимилеВОбластиМакета(ОбластьМакета, ДанныеПечати.Организация, ПодписиИФаксимиле, Ошибки);		
		// -ФК MF_Задача №3 30.09.2021 Ошибка вывода формы печати: получение файлов факсимилек

// +ФК MF_Задача №4 30.09.2021  В справочнике Контрагенты  Устанавливать Статус СБ - Согласован
ВЫБРАТЬ   ПЕРВЫЕ 100
уатСведенияОКонтрагентах_уэ.Перевозчик КАК Перевозчик ,
уатСведенияОКонтрагентах_уэ.Контрагент,
ИсторияСБ.СтатусСБ ,
MAX(ИсторияСБ.Период)
ИЗ
РегистрСведений.уатСведенияОКонтрагентах_уэ КАК уатСведенияОКонтрагентах_уэ
ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.Флит_ИсторияСтатусовСБОбъектов КАК ИсторияСБ
ПО ИсторияСБ.Объект = уатСведенияОКонтрагентах_уэ.Контрагент
ГДЕ уатСведенияОКонтрагентах_уэ.Перевозчик
СГРУППИРОВАТЬ ПО
уатСведенияОКонтрагентах_уэ.Перевозчик,
уатСведенияОКонтрагентах_уэ.Контрагент,
ИсторияСБ.СтатусСБ


// -ФК MF_Задача №4 30.09.2021  В справочнике Контрагенты  Устанавливать Статус СБ - Согласован

// +ФК MF_Задача №6 01.10.2021 ВПФ.Заявка перевозчика "Флит Компани": изменить дату в Печатной форме "Договор-заявки перевозчику" и в Печатной форме "Заявка перевозчику" Подставлять дату, более раннюю между датой создания "Заказа на ТС" и датой  Заказе на ТС "Отправление с" 
// -ФК MF_Задача №6 01.10.2021 ВПФ.Заявка перевозчика "Флит Компани": изменить дату в Печатной форме "Договор-заявки перевозчику" и в Печатной форме "Заявка перевозчику" Подставлять дату, более раннюю между датой создания "Заказа на ТС" и датой  Заказе на ТС "Отправление с" 
		// +ФК MF_Задача №6 01.10.2021 ВПФ.Заявка перевозчика "Флит Компани": изменить дату в Печатной форме "Договор-заявки перевозчику" и в Печатной форме "Заявка перевозчику" Подставлять дату, более раннюю между датой создания "Заказа на ТС" и датой  Заказе на ТС "Отправление с" 
		//ОбластьМакета.Параметры.Дата = Формат(ДанныеПечати.Дата, "ДФ='dd.MM.yyyy ""г.""'");
		Если НЕ ДанныеПечати.Документ.FTL Тогда
			ОбластьМакета.Параметры.Дата = Формат(ДанныеПечати.ОтправлениеС, "ДФ='dd.MM.yyyy ""г.""'");
		Иначе
			Если ДанныеПечати.Документ.ПромежуточныеПункты.Количество()=0 Тогда
				ОбластьМакета.Параметры.Дата = Формат(ДанныеПечати.ОтправлениеС, "ДФ='dd.MM.yyyy ""г.""'");
			Иначе
				ОбластьМакета.Параметры.Дата = Формат(ДанныеПечати.Документ.ПромежуточныеПункты[0].ОкноС, "ДФ='dd.MM.yyyy ""г.""'");

			КонецЕсли;
		КонецЕсли;
		
		// -ФК MF_Задача №6 01.10.2021 ВПФ.Заявка перевозчика "Флит Компани": изменить дату в Печатной форме "Договор-заявки перевозчику" и в Печатной форме "Заявка перевозчику" Подставлять дату, более раннюю между датой создания "Заказа на ТС" и датой  Заказе на ТС "Отправление с" 
НаличиеДокумента_e7e665c9f4fb47b7b06372694c1dd827

	                                                    ВЫБРАТЬ
	                      уатМаршрутныйЛист.Ссылка КАК Документ,
	                      уатМаршрутныйЛист.Номер КАК Номер,
	                      уатМаршрутныйЛист.Дата КАК Дата,
	                      уатМаршрутныйЛист.Организация КАК Организация,
	                      уатМаршрутныйЛист.Контрагент КАК Контрагент,
	                      уатМаршрутныйЛист.ТС КАК ТС,
	                      уатМаршрутныйЛист.Расш1_ОтсрочкаПеревозчику КАК Расш1_ОтсрочкаПеревозчику,
						  уатМаршрутныйЛист.Расш1_ВидДней КАК Расш1_ВидДней,
	                      СпрТС.ВладелецТС КАК ВладелецТС,
	                      уатМаршрутныйЛист.Водитель1 КАК Водитель1,
	                      СпрТС.Марка КАК Марка,
	                      СпрТС.ГосударственныйНомер КАК ГосударственныйНомер,
	                      СпрТС.ГодВыпуска КАК ГодВыпуска,
	                      СпрПрицеп.Ссылка КАК Прицеп,
	                      СпрПрицеп.ВладелецТС КАК ВладелецПрицеп,
	                      СпрПрицеп.Марка КАК МаркаПрицеп,
	                      СпрПрицеп.ГосударственныйНомер КАК ГосударственныйНомерПрицеп,
	                      СпрПрицеп.ГодВыпуска КАК ГодВыпускаПрицеп,
	                      уатМаршрутныйЛистЗаказы.ЗаказГрузоотправителя КАК ЗаказГрузоотправителя,
	                      ВодительКИ.Представление КАК ТелефонВодителя,
	                      ВодительАдрес.Представление КАК АдресВодителя,
	                      РасходыМЛ.Сумма КАК СуммаРасходовМЛ,
	                      РасходыМЛ.СтавкаНДС КАК СтавкаНДСМЛ,
	                      уатМаршрутныйЛист.ДоговорКонтрагента КАК ДоговорКонтрагента
	                      ПОМЕСТИТЬ ВТ_МаршрутныйЛист
	                      ИЗ
	                      Документ.уатМаршрутныйЛист КАК уатМаршрутныйЛист
	                      	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.уатТС КАК СпрПрицеп
	                      	ПО уатМаршрутныйЛист.Прицеп1 = СпрПрицеп.Ссылка
	                      	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.уатТС КАК СпрТС
	                      	ПО уатМаршрутныйЛист.ТС = СпрТС.Ссылка
	                      	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.уатМаршрутныйЛист.Заказы КАК уатМаршрутныйЛистЗаказы
	                      	ПО уатМаршрутныйЛист.Ссылка = уатМаршрутныйЛистЗаказы.Ссылка
	                      	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ФизическиеЛица.КонтактнаяИнформация КАК ВодительКИ
	                      	ПО уатМаршрутныйЛист.Водитель1 = ВодительКИ.Ссылка
	                      		И (ВодительКИ.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.Телефон))
	                      	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ФизическиеЛица.КонтактнаяИнформация КАК ВодительАдрес
	                      	ПО уатМаршрутныйЛист.Водитель1 = ВодительАдрес.Ссылка
	                      		И (ВодительАдрес.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.АдресПоПропискеФизическиеЛица))
	                      		И (ВодительАдрес.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.Адрес))
	                      	ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	                      		СУММА(уатМаршрутныйЛистРасходы.Сумма) КАК Сумма,
	                      		МАКСИМУМ(уатМаршрутныйЛистРасходы.СтавкаНДС) КАК СтавкаНДС,
	                      		уатМаршрутныйЛистРасходы.Ссылка КАК Ссылка
	                      	ИЗ
	                      		Документ.уатМаршрутныйЛист.Расходы КАК уатМаршрутныйЛистРасходы
	                      	
	                      	СГРУППИРОВАТЬ ПО
	                      		уатМаршрутныйЛистРасходы.Ссылка) КАК РасходыМЛ
	                      	ПО уатМаршрутныйЛист.Ссылка = РасходыМЛ.Ссылка
	                      ГДЕ
	                      уатМаршрутныйЛист.Ссылка = &Док
	                      И уатМаршрутныйЛист.Проведен
	                      
	                      СГРУППИРОВАТЬ ПО
	                      уатМаршрутныйЛист.Ссылка,
	                      уатМаршрутныйЛист.Номер,
	                      уатМаршрутныйЛист.Дата,
	                      уатМаршрутныйЛист.Организация,
	                      уатМаршрутныйЛист.Контрагент,
	                      уатМаршрутныйЛист.ТС,
	                      уатМаршрутныйЛист.Расш1_ОтсрочкаПеревозчику,
						  уатМаршрутныйЛист.Расш1_ВидДней,
	                      уатМаршрутныйЛист.Водитель1,
	                      СпрТС.Марка,
	                      СпрТС.ГосударственныйНомер,
	                      СпрТС.ГодВыпуска,
	                      СпрПрицеп.Ссылка,
	                      СпрПрицеп.Марка,
	                      СпрПрицеп.ГосударственныйНомер,
	                      СпрПрицеп.ГодВыпуска,
	                      уатМаршрутныйЛистЗаказы.ЗаказГрузоотправителя,
	                      ВодительКИ.Представление,
	                      ВодительАдрес.Представление,
	                      СпрТС.ВладелецТС,
	                      СпрПрицеп.ВладелецТС,
	                      РасходыМЛ.Сумма,
	                      РасходыМЛ.СтавкаНДС,
	                      уатМаршрутныйЛист.ДоговорКонтрагента
	                      ;
	                      
	                      ////////////////////////////////////////////////////////////////////////////////

	                      ВЫБРАТЬ
	                      	уатЗаказГрузоотправителя.Ссылка КАК Документ,
	                      	уатЗаказГрузоотправителя.Номер КАК Номер,
	                      	уатЗаказГрузоотправителя.Дата КАК Дата,
	                      	уатЗаказГрузоотправителя.Организация КАК Организация,
	                      	ВТ_МаршрутныйЛист.Контрагент КАК Контрагент,
	                      	ДоговорыКонтрагентов.Номер КАК НомерДоговора,
	                      	ДоговорыКонтрагентов.Дата КАК ДатаДоговора,
	                      	уатЗаказГрузоотправителя.ТребованиеКТС КАК ТребованиеКТС,
	                      	уатЗаказГрузоотправителя.ДоставкаПо КАК ДатаОканчания,
	                      	уатЗаказГрузоотправителя.ОтправлениеС КАК ОтправлениеС,
	                      	уатЗаказГрузоотправителя.ДоставкаС КАК ДоставкаС,
	                      	уатЗаказГрузоотправителя.АдресОтправления КАК АдресОтправления,
	                      	КЛГрузоотправителя.Ссылка КАК КонтактноеЛицоГрузоотправителя,
	                      	ГрузоотправительКИ.Представление КАК ТелефонГрузоотправителя,
	                      	уатЗаказГрузоотправителя.АдресНазначения КАК АдресНазначения,
	                      	КЛГрузополучателя.Ссылка КАК КонтактноеЛицоГрузополучателя,
	                      	ГрузополучательКИ.Представление КАК ТелефонГрузополучателя,
	                      	Пользователи.Ссылка КАК Ответственный,
	                      	ОтветственныйТел.Представление КАК ОтветственныйТел,
	                      	ОтветственныйПочта.Представление КАК ОтветственныйПочта,
0 КАК ТипМакета,
	                      	уатМоделиТС.Ссылка КАК МодельТС,
	                      	уатМоделиТС.Грузоподъемность КАК ГрузоподъемностьТС,
	                      	уатМоделиТС.ОбъемКузова КАК ОбъемКузоваТС,
	                      	уатЗаказГрузоотправителя.ВалютаДокумента КАК ВалютаДокумента,
	                      	ВТ_МаршрутныйЛист.ТС КАК ТС,
	                      	ВТ_МаршрутныйЛист.ВладелецТС КАК ВладелецТС,
	                      	ВТ_МаршрутныйЛист.Водитель1 КАК Водитель1,
	                      	ВТ_МаршрутныйЛист.Марка КАК Марка,
	                      	ВТ_МаршрутныйЛист.ГосударственныйНомер КАК ГосударственныйНомер,
	                      	ВТ_МаршрутныйЛист.ГодВыпуска КАК ГодВыпуска,
	                      	ВТ_МаршрутныйЛист.Прицеп КАК Прицеп,
	                      	ВТ_МаршрутныйЛист.ВладелецПрицеп КАК ВладелецПрицеп,
	                      	ВТ_МаршрутныйЛист.МаркаПрицеп КАК МаркаПрицеп,
	                      	ВТ_МаршрутныйЛист.ГосударственныйНомерПрицеп КАК ГосударственныйНомерПрицеп,
	                      	ВТ_МаршрутныйЛист.ГодВыпускаПрицеп КАК ГодВыпускаПрицеп,
	                      	ВТ_МаршрутныйЛист.ТелефонВодителя КАК ТелефонВодителя,
	                      	ВТ_МаршрутныйЛист.АдресВодителя КАК АдресВодителя,
						  	ВТ_МаршрутныйЛист.Расш1_ОтсрочкаПеревозчику КАК ОтсрочкаПеревозчику,
						  	ВТ_МаршрутныйЛист.Расш1_ВидДней КАК ВидДнейОтсрочкиПеревозчику,
	                      	уатЗаказГрузоотправителя.СуммаДокумента КАК СуммаДокумента,
	                      	уатЗаказГрузоотправителяУслуги.СтавкаНДС КАК СтавкаНДС,
	                      	0 КАК ТемпРежим,
	                      	ВТ_МаршрутныйЛист.СуммаРасходовМЛ КАК СуммаРасходовМЛ,
	                      	ВТ_МаршрутныйЛист.СтавкаНДСМЛ КАК СтавкаНДСМЛ
	                      ПОМЕСТИТЬ ВТ_Документы
	                      ИЗ
	                      	ВТ_МаршрутныйЛист КАК ВТ_МаршрутныйЛист
	                      		ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатЗаказГрузоотправителя КАК уатЗаказГрузоотправителя
	                      			ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КонтактныеЛица КАК КЛГрузополучателя
	                      				ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КонтактныеЛица.КонтактнаяИнформация КАК ГрузополучательКИ
	                      				ПО КЛГрузополучателя.Ссылка = ГрузополучательКИ.Ссылка
	                      					И (ГрузополучательКИ.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.Телефон))
	                      					И (ГрузополучательКИ.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.ТелефонМобильныйКонтактныеЛица))
	                      			ПО уатЗаказГрузоотправителя.КонтактноеЛицоГрузополучателя = КЛГрузополучателя.Ссылка
	                      			ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КонтактныеЛица КАК КЛГрузоотправителя
	                      				ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КонтактныеЛица.КонтактнаяИнформация КАК ГрузоотправительКИ
	                      				ПО КЛГрузоотправителя.Ссылка = ГрузоотправительКИ.Ссылка
	                      					И (ГрузоотправительКИ.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.Телефон))
	                      					И (ГрузоотправительКИ.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.ТелефонМобильныйКонтактныеЛица))
	                      			ПО уатЗаказГрузоотправителя.КонтактноеЛицоГрузоотправителя = КЛГрузоотправителя.Ссылка
	                      			ЛЕВОЕ СОЕДИНЕНИЕ Справочник.уатМоделиТС КАК уатМоделиТС
	                      			ПО уатЗаказГрузоотправителя.ТребованиеКТС = уатМоделиТС.Ссылка
	                      			ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Пользователи КАК Пользователи
	                      				ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Пользователи.КонтактнаяИнформация КАК ОтветственныйПочта
	                      				ПО Пользователи.Ссылка = ОтветственныйПочта.Ссылка
	                      					И (ОтветственныйПочта.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.АдресЭлектроннойПочты))
	                      					И (ОтветственныйПочта.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.EmailПользователя))
	                      				ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Пользователи.КонтактнаяИнформация КАК ОтветственныйТел
	                      				ПО Пользователи.Ссылка = ОтветственныйТел.Ссылка
	                      					И (ОтветственныйТел.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.Телефон))
	                      					И (ОтветственныйТел.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.ТелефонПользователя))
	                      			ПО уатЗаказГрузоотправителя.Ответственный = Пользователи.Ссылка
	                      			ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатЗаказГрузоотправителя.Услуги КАК уатЗаказГрузоотправителяУслуги
	                      			ПО уатЗаказГрузоотправителя.Ссылка = уатЗаказГрузоотправителяУслуги.Ссылка
	                      			ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	                      				уатЗаказГрузоотправителяДополнительныеРеквизиты.Ссылка КАК Заказ,
	                      				уатЗаказГрузоотправителяДополнительныеРеквизиты.Значение КАК ТемпРежим
	                      			ИЗ
	                      				Документ.уатЗаказГрузоотправителя.ДополнительныеРеквизиты КАК уатЗаказГрузоотправителяДополнительныеРеквизиты
	                      					ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.ДополнительныеРеквизитыИСведения КАК ДополнительныеРеквизитыИСведения
	                      					ПО уатЗаказГрузоотправителяДополнительныеРеквизиты.Свойство = ДополнительныеРеквизитыИСведения.Ссылка
	                      			) КАК ВлТемпРежим
	                      			ПО уатЗаказГрузоотправителя.Ссылка = ВлТемпРежим.Заказ
	                      		ПО ВТ_МаршрутныйЛист.ЗаказГрузоотправителя = уатЗаказГрузоотправителя.Ссылка
	                      		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ДоговорыКонтрагентов КАК ДоговорыКонтрагентов
	                      			ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ДоговорыКонтрагентов.ДополнительныеРеквизиты КАК ДоговорыДР
	                      			ПО ДоговорыКонтрагентов.Ссылка = ДоговорыДР.Ссылка
	                      				И (ДоговорыДР.Свойство.Имя = &Нал)
	                      		ПО ВТ_МаршрутныйЛист.ДоговорКонтрагента = ДоговорыКонтрагентов.Ссылка
	                      
	                      СГРУППИРОВАТЬ ПО
	                      	ВТ_МаршрутныйЛист.ТС,
	                      	ВТ_МаршрутныйЛист.Водитель1,
	                      	ВТ_МаршрутныйЛист.МаркаПрицеп,
	                      	ВТ_МаршрутныйЛист.ГосударственныйНомер,
	                      	ВТ_МаршрутныйЛист.ТелефонВодителя,
	                      	ВТ_МаршрутныйЛист.АдресВодителя,
						  	ВТ_МаршрутныйЛист.Расш1_ОтсрочкаПеревозчику,
						  	ВТ_МаршрутныйЛист.Расш1_ВидДней,
	                      	ВТ_МаршрутныйЛист.ВладелецПрицеп,
	                      	уатМоделиТС.Ссылка,
	                      	ВТ_МаршрутныйЛист.ВладелецТС,
	                      	ВТ_МаршрутныйЛист.Прицеп,
	                      	ВТ_МаршрутныйЛист.Марка,
	                      	ВТ_МаршрутныйЛист.ГосударственныйНомерПрицеп,
	                      	уатЗаказГрузоотправителяУслуги.СтавкаНДС,
	                      	уатЗаказГрузоотправителя.Ссылка,
	                      	КЛГрузополучателя.Ссылка,
	                      	ДоговорыКонтрагентов.Дата,
	                      	ДоговорыКонтрагентов.Номер,
	                      	КЛГрузоотправителя.Ссылка,
	                      	ГрузоотправительКИ.Представление,
	                      	ГрузополучательКИ.Представление,
	                      	ОтветственныйТел.Представление,
	                      	ОтветственныйПочта.Представление,
	                      	Пользователи.Ссылка,
	                      	ВЫБОР
	                      		КОГДА ЕСТЬNULL(ДоговорыДР.Значение,&Пусто) = 0
	                      			ТОГДА 0
	                      		ИНАЧЕ 1
	                      	КОНЕЦ,
	                      	уатЗаказГрузоотправителя.Номер,
	                      	уатЗаказГрузоотправителя.Дата,
	                      	уатЗаказГрузоотправителя.Организация,
	                      	ВТ_МаршрутныйЛист.Контрагент,
	                      	уатЗаказГрузоотправителя.ТребованиеКТС,
	                      	уатЗаказГрузоотправителя.ДоставкаПо,
	                      	уатЗаказГрузоотправителя.ОтправлениеС,
	                      	уатЗаказГрузоотправителя.ДоставкаС,
	                      	уатЗаказГрузоотправителя.АдресОтправления,
	                      	уатЗаказГрузоотправителя.АдресНазначения,
	                      	уатМоделиТС.Грузоподъемность,
	                      	уатМоделиТС.ОбъемКузова,
	                      	уатЗаказГрузоотправителя.ВалютаДокумента,
	                      	ВТ_МаршрутныйЛист.ГодВыпуска,
	                      	ВТ_МаршрутныйЛист.ГодВыпускаПрицеп,
	                      	уатЗаказГрузоотправителя.СуммаДокумента,
	                      	ЕСТЬNULL(ВлТемпРежим.ТемпРежим, &Пусто),
	                      	ВТ_МаршрутныйЛист.СуммаРасходовМЛ,
	                      	ВТ_МаршрутныйЛист.СтавкаНДСМЛ

