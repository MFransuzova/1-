&НаСервере
Процедура СогласоватьПеревозчикаНаСервере()
	Запрос = Новый Запрос;
	Запрос.Текст = "
	|ВЫБРАТЬ   
	|уатСведенияОКонтрагентах_уэ.Перевозчик КАК Перевозчик ,
	|уатСведенияОКонтрагентах_уэ.Контрагент,
	|ИсторияСБ.СтатусСБ ,
	|MAX(ИсторияСБ.Период)
	|ИЗ
	|РегистрСведений.уатСведенияОКонтрагентах_уэ КАК уатСведенияОКонтрагентах_уэ
	|ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.Флит_ИсторияСтатусовСБОбъектов КАК ИсторияСБ
	|ПО ИсторияСБ.Объект = уатСведенияОКонтрагентах_уэ.Контрагент
	|ГДЕ уатСведенияОКонтрагентах_уэ.Перевозчик
	|СГРУППИРОВАТЬ ПО
	|уатСведенияОКонтрагентах_уэ.Перевозчик,
	|уатСведенияОКонтрагентах_уэ.Контрагент,
	|ИсторияСБ.СтатусСБ
	|";
	Результат = Запрос.Выполнить().Выгрузить();
	Если Результат.Количество()=0 Тогда
		Возврат;
	КонецЕсли;
	Согласован = Справочники.Флит_СтатусыСБ.НайтиПоНаименованию("Согласован") ;
	
	Для каждого стр из Результат Цикл
		Если стр.СтатусСБ = Согласован Тогда
			Продолжить;
		КонецЕсли;
		УстановитьПривилегированныйРежим(Истина);
		
		//Записать объект может пользователь без прав сотрудника СБ
		МЗ = РегистрыСведений.Флит_ИсторияСтатусовСБОбъектов.СоздатьМенеджерЗаписи();
		МЗ.Объект = Стр.Контрагент;
		МЗ.Период = ТекущаяДата();
		МЗ.СтатусСБ = Согласован;
		МЗ.Ответственный = ПараметрыСеанса.ТекущийПользователь;
		МЗ.Записать(Истина);
		УстановитьПривилегированныйРежим(Ложь);
		
	КонецЦикла;
КонецПроцедуры

&НаКлиенте
Процедура СогласоватьПеревозчика(Команда)
	СогласоватьПеревозчикаНаСервере();
КонецПроцедуры
