//+СА Французова Мария 2021-08-13 № 19470 (Спр.ФорматыМагазинов (Элементы) : добавление реквизитов (основная) вывод расширение )

&НаСервере
Процедура 	ПолучитьСписокФорматов(Структура)
	Структура.Вставить("ТекСсылка",Объект.Ссылка) ;
	Список = Новый Массив;   
	Запрос = Новый Запрос;
	Запрос.Текст = "
	|ВЫБРАТЬ ПЕРВЫЕ 100
	|Спр.Ссылка.Наименование КАК Наименование,
	|Спр.Ссылка
	|ИЗ Справочник.ФорматыМагазинов КАК Спр
	|ГДЕ Спр.СА_Организация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	|И НЕ Спр.Ссылка = &ТекСсылка %1
	|УПОРЯДОЧИТЬ ПО
	|Спр.Наименование ВОЗР
	|";
	
	Для каждого ск из Структура Цикл
		Запрос.УстановитьПараметр(ск.Ключ,ск.Значение);
	КонецЦикла;
	Если Структура.Свойство("Текст") Тогда
		Запрос.Текст = СтрЗаменить(Запрос.Текст,"%1",?(ЗначениеЗаполнено(Структура.Текст)," И Ссылка.Наименование ПОДОБНО &Текст ","")); 
	Иначе
		Запрос.Текст = СтрЗаменить(Запрос.Текст,"%1",""); 
	КонецЕсли;
	Элементы.СА_НеУчитываемыеПозицииФорматовМагазина.СписокВыбора.Очистить();
	Результат = Запрос.Выполнить().Выгрузить();
	Для каждого стр из Результат Цикл
		Список.Добавить(стр.Ссылка);
		Элементы.СА_НеУчитываемыеПозицииФорматовМагазина.СписокВыбора.Добавить(стр.Ссылка,стр.Наименование);
	КонецЦикла;	
	Структура.Вставить("ДанныеВыбора",Результат.ВыгрузитьКолонку("Ссылка"));
	//Элементы.СА_НеУчитываемыеПозицииФорматовМагазина.СписокВыбора = Результат.ВыгрузитьКолонку("Ссылка");
КонецПроцедуры
//-СА Французова Мария 2021-08-13 № 19470 (Спр.ФорматыМагазинов (Элементы) : добавление реквизитов (основная) вывод расширение )


//+СА Французова Мария 2021-08-10 № 19470 (Спр.ФорматыМагазинов (Элементы) : добавление реквизитов (основная) вывод расширение )
&НаСервере
Процедура NU_ПриСозданииНаСервереПосле(Отказ, СтандартнаяОбработка)
	//Сообщение = Новый СообщениеПользователю;
	//Сообщение.Текст = "NU_ПриСозданииНаСервереПосле_ФМ";
	//Сообщение.Сообщить();
	
	//+СА Французова Мария 2021-08-10 № 19470 (Спр.ФорматыМагазинов (Элементы) : добавление реквизитов (основная) вывод расширение )
	Поле_СА_МаркированнаяПродукция                          = Элементы.Добавить("СА_Организация", Тип("ПолеФормы"), ЭтаФорма);
	Поле_СА_МаркированнаяПродукция.Вид                      = ВидПоляФормы.ПолеВвода;    
	Поле_СА_МаркированнаяПродукция.Заголовок                = "Организация";
	Поле_СА_МаркированнаяПродукция.ПутьКДанным              = "Объект.СА_Организация";
	
	//-СА Французова Мария 2021-08-10 № 19470 (Спр.ФорматыМагазинов (Элементы) : добавление реквизитов (основная) вывод расширение )	
	//+СА Французова Мария 2021-08-11 № 19470 (Спр.ФорматыМагазинов (Элементы) : добавление реквизитов (основная) вывод расширение )
	Поле_СА_МаркированнаяПродукция                          = Элементы.Добавить("СА_НеУчитываемыеПозицииФорматовМагазина", Тип("ПолеФормы"), ЭтаФорма);
	Поле_СА_МаркированнаяПродукция.Вид                      = ВидПоляФормы.ПолеВвода;    
	Поле_СА_МаркированнаяПродукция.Заголовок                = "Не учитываемые позиции Форматов Магазина";
	Поле_СА_МаркированнаяПродукция.ПутьКДанным              = "Объект.СА_НеУчитываемыеПозицииФорматовМагазина";
	Поле_СА_МаркированнаяПродукция.РежимВыбораИЗСписка      = Истина;
	Если НЕ Элементы.Найти("СА_НеУчитываемыеПозицииФорматовМагазина") = Неопределено Тогда
		Поле_СА_МаркированнаяПродукция.УстановитьДействие("АвтоПодбор","СА_МаркированнаяПродукция_АвтоПодбор");
		Поле_СА_МаркированнаяПродукция.УстановитьДействие("НачалоВыбора","СА_МаркированнаяПродукция_НачалоВыбора");
		Поле_СА_МаркированнаяПродукция.УстановитьДействие("НачалоВыбораИЗСписка","СА_МаркированнаяПродукция_НачалоВыбораИЗСписка");
		Поле_СА_МаркированнаяПродукция.УстановитьДействие("ПриИзменении","СА_МаркированнаяПродукция_ПриИзменении");
		Поле_СА_МаркированнаяПродукция.УстановитьДействие("ОкончаниеВводаТекста","СА_МаркированнаяПродукция_ОкончаниеВводаТекстаПосле");
		Структура = Новый Структура;

		ПолучитьСписокФорматов(Структура); 

	КонецЕсли;
	
	//-СА Французова Мария 2021-08-11 № 19470 (Спр.ФорматыМагазинов (Элементы) : добавление реквизитов (основная) вывод расширение )	
	
КонецПроцедуры
//-СА Французова Мария 2021-08-10 № 19470 (Спр.ФорматыМагазинов (Элементы) : добавление реквизитов (основная) вывод расширение )
&Вместо("АвтоПодбор")
&НаКлиенте
Процедура СА_МаркированнаяПродукция_АвтоПодбор(Элемент, Текст, ДанныеВыбора, ПараметрыПолученияДанных, Ожидание, СтандартнаяОбработка) Экспорт
	Если НЕ Элемент.Имя = "СА_НеУчитываемыеПозицииФорматовМагазина" Тогда
		Возврат;
	КонецЕсли;
	
	СтандартнаяОбработка = Ложь;
	//Сообщение = Новый СообщениеПользователю;
	//Сообщение.Текст = "СА_МаркированнаяПродукция_АвтоПодбор";
	//Сообщение.Сообщить();
	Структура = Новый Структура;
	Структура.Вставить("Текст",СокрЛП(Текст));
	ПолучитьСписокФорматов(Структура); 
	Если Структура.Свойство("ДанныеВыбора") Тогда
		ПараметрВыбора = Новый ПараметрВыбора("Отбор.Ссылка",Структура.ДанныеВыбора); 
		ДанныеВыбора1 = Новый СписокЗначений;
		ДанныеВыбора1.ЗагрузитьЗначения(Структура.ДанныеВыбора);
		Элемент.РежимВыбораИзСписка= истина;
		Элемент.СписокВыбора.ЗагрузитьЗначения(ДанныеВыбора1);
		
	Иначе
		СтандартнаяОбработка = Истина;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура СА_МаркированнаяПродукция_ОкончаниеВводаТекстаПосле(Элемент, Текст, ДанныеВыбора, ПараметрыПолученияДанных, СтандартнаяОбработка)
	Если НЕ Элемент.Имя = "СА_НеУчитываемыеПозицииФорматовМагазина" Тогда
		Возврат;
	КонецЕсли;
	
	СтандартнаяОбработка = Ложь;
	Структура = Новый Структура;
	
	ПолучитьСписокФорматов(Структура); 
	Структура.Вставить("Текст",СокрЛП(Текст));
	
	Если Структура.Свойство("ДанныеВыбора") Тогда
		ДанныеВыбора  = Структура.ДанныеВыбора;
	Иначе
		СтандартнаяОбработка = Истина;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура СА_МаркированнаяПродукция_НачалоВыбора(Элемент, ДанныеВыбора,СтандартнаяОбработка)
	//СтандартнаяОбработка = Ложь;
	////Сообщение = Новый СообщениеПользователю;
	////Сообщение.Текст = "СА_МаркированнаяПродукция_НачалоВыбора";
	////Сообщение.Сообщить();
	//Структура = Новый Структура;
	////Структура.Вставить("Текст",СокрЛП(Текст));
	//ПолучитьСписокФорматов(Структура); 
	//Если Структура.Свойство("ДанныеВыбора") Тогда
	//	//ДанныеВыбора = Новый СписокЗначений;  
	//	//ДанныеВыбора.ЗагрузитьЗначения(Структура.ДанныеВыбора) ;
	//	//значениеОповещения = Структура;
	//	//значениеОповещения.Вставить("СА_НеУчитываемыеПозицииФорматовМагазина",);
	//	//Оповещение = Новый ОписаниеОповещения("ВыполнитьПослеВыбораФормата",ЭтаФорма,значениеОповещения);
	//	//ЭлементСписка = ДанныеВыбора.НайтиПоЗначению(Объект.СА_НеУчитываемыеПозицииФорматовМагазина);
	//	//ПоказатьВыборИзСписка(Оповещение,ДанныеВыбора,Элемент,ЭлементСписка) ;
	//Иначе
	//	СтандартнаяОбработка = Истина;
	//КонецЕсли;
	//
КонецПроцедуры

&НаКлиенте
Процедура СА_МаркированнаяПродукция_НачалоВыбораИЗСписка(Элемент, ДанныеВыбора,СтандартнаяОбработка)
КонецПроцедуры

&НаКлиенте
Процедура СА_МаркированнаяПродукция_ПриИзменении(Элемент, СтандартнаяОбработка)
	//СтандартнаяОбработка = Ложь;
	//Сообщение = Новый СообщениеПользователю;
	//Сообщение.Текст = "СА_МаркированнаяПродукция_НачалоВыбора";
	//Сообщение.Сообщить();
КонецПроцедуры

&НаКлиенте
Процедура NU_ОбработкаОповещенияПосле(ИмяСобытия, Параметр, Источник)
	//Если ИмяСобытия = "ВыполнитьПослеВыбораФормата" Тогда
	//	Объект.СА_НеУчитываемыеПозицииФорматовМагазина = Параметр;
	//КонецЕсли;
	
КонецПроцедуры
//+СА Французова Мария 2021-08-16 № 19470 (Спр.ФорматыМагазинов (Элементы) : добавление реквизитов (основная) вывод расширение )

&НаКлиенте
Процедура ВыполнитьПослеВыбораФормата(Результат,ПараметрОповещения) Экспорт
	Если Результат = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	Объект.СА_НеУчитываемыеПозицииФорматовМагазина = Результат.Значение;
КонецПроцедуры
//-СА Французова Мария 2021-08-16 № 19470 (Спр.ФорматыМагазинов (Элементы) : добавление реквизитов (основная) вывод расширение )
//+СА Французова Мария 2021-08-16 № 19470 (Спр.ФорматыМагазинов (Элементы) : добавление реквизитов (основная) вывод расширение )

&НаКлиенте
Процедура NU_ОбработкаВыбораПосле(ВыбранноеЗначение, ИсточникВыбора)
	// Вставить содержимое обработчика.
КонецПроцедуры

&НаКлиенте
Процедура NU_ВыборЗначенияПосле(СтандартнаяОбработка)
	// Вставить содержимое обработчика.
КонецПроцедуры
//-СА Французова Мария 2021-08-16 № 19470 (Спр.ФорматыМагазинов (Элементы) : добавление реквизитов (основная) вывод расширение )




