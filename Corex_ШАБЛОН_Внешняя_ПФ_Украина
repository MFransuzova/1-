// + Corex Французова 26.07.2022 (Доработка 820)
Функция СведенияОВнешнейОбработке() Экспорт
	
	ПараметрыРегистрации = Новый Структура;
	
	МассивНазначений = Новый Массив;
	МассивНазначений.Добавить("Документ.РеализацияТоваровУслуг");
	
	ПараметрыРегистрации.Вставить("Вид", "ПечатнаяФорма"); //возможны варианты - ЗаполнениеОбъекта, ДополнительныйОтчет, СозданиеСвязанныхОбъектов,
	ПараметрыРегистрации.Вставить("Назначение", МассивНазначений);
	ПараметрыРегистрации.Вставить("Наименование", "Накладная на товары Corex UKREN"); //имя под kt обработка зарегистрирована будет в справочнике внешних обработок
	ПараметрыРегистрации.Вставить("Версия", "1.1.4");
	ПараметрыРегистрации.Вставить("БезопасныйРежим", ЛОЖЬ);
	ПараметрыРегистрации.Вставить("Информация", "Дополнительная печатная форма к документу РеализацияТоваровУслуг ");
	
	//команды
	ТаблицаКоманд = Новый ТаблицаЗначений;
	ТаблицаКоманд.Колонки.Добавить("Представление"); //как будет выглядеть описание печ.формы для пользователя
	ТаблицаКоманд.Колонки.Добавить("Идентификатор"); //имя нашего макета
	ТаблицаКоманд.Колонки.Добавить("Использование"); //ВызовСерверногоМетода
	ТаблицаКоманд.Колонки.Добавить("ПоказыватьОповещение"); //Истина
	ТаблицаКоманд.Колонки.Добавить("Модификатор"); //ПечатьМХL
	
	НоваяКоманда = ТаблицаКоманд.Добавить();
	НоваяКоманда.Представление = "Накладная на товары Corex UKREN";
	НоваяКоманда.Идентификатор = "НакладнаяТоварыUKREN"; //Внешняя печатная форма
	НоваяКоманда.Использование = "ВызовСерверногоМетода"; //здесь можно прописать использование как серверного так и клиентского, отличие в том, что серверный метод будет обращаться к экспортной процедуре из модуля объекта, клиентский - к экспортной процедуре из модуля формы объекта
	НоваяКоманда.ПоказыватьОповещение = Истина;
	НоваяКоманда.Модификатор = "ПечатьMXL";
	
	ПараметрыРегистрации.Вставить("Команды", ТаблицаКоманд);
	
	Возврат ПараметрыРегистрации;
	
КонецФункции
// - Corex Французова 26.07.2022 (Доработка 820)
// + Corex Французова 26.07.2022 (Доработка 820)
Функция СформироватьЗаголовокДокумента(ДокументОбъект, НазваниеДокумента = "", КодЯзыка = Неопределено) Экспорт
	
	Если КодЯзыка = Неопределено Тогда 
		КодЯзыка = Локализация.ПолучитьЯзыкФормированияПечатныхФорм();
	КонецЕсли;
	
	Если ДокументОбъект = Неопределено Тогда
		Возврат "";
	Иначе
		Возврат ?(НЕ ЗначениеЗаполнено(НазваниеДокумента), ДокументОбъект.Метаданные().Синоним, НазваниеДокумента) + " № "
		+ ПрефиксацияОбъектовКлиентСервер.ПолучитьНомерНаПечать(ДокументОбъект.Номер, Истина, Истина)
		+ НСтр("ru=' от ';en=' dated ';uk=' від '",КодЯзыка) + Формат(ДокументОбъект.Дата, "ДФ='дд ММММ гггг';Л="+ ОпределитьКодЯзыкаДляФормат(КодЯзыка)) + НСтр("ru=' г.';en=' ';uk=' р.'",КодЯзыка);
	КонецЕсли;
	
КонецФункции // СформироватьЗаголовокДокумента()
// - Corex Французова 26.07.2022 (Доработка 820)
// + Corex Французова 26.07.2022 (Доработка 820)
//Преобразует код языка в формат понятный системной фунции Формат()
// Параметры
//  КодЯзыка  	 – Строка – код языка в формате uk/ru
//
// Возвращаемое значение:
//   Строка   	 – код языка в формате ru_RU/uk_UA
//
Функция ОпределитьКодЯзыкаДляФормат(КодЯзыка) Экспорт
	
	Возврат ?(КодЯзыка = "uk","uk_UA",?(КодЯзыка = "en","en_US","ru_RU"));
	
КонецФункции 
// - Corex Французова 26.07.2022 (Доработка 820)

Процедура Печать(МассивОбъектов, КоллекцияПечатныхФорм,ОбъектыПечати, ПараметрыВывода) Экспорт

	// Устанавливаем признак доступности печати покомплектно.
	ПараметрыВывода.ДоступнаПечатьПоКомплектно = Истина;

	// Проверяем, нужно ли для макета ОтчетККМ формировать табличный документ.
	Если УправлениеПечатью.НужноПечататьМакет(КоллекцияПечатныхФорм, "НакладнаяТоварыUKREN") Тогда
		// Формируем табличный документ и добавляем его в коллекцию печатных форм.
		ИмяМакета = "";
		УправлениеПечатью.ВывестиТабличныйДокументВКоллекцию(КоллекцияПечатныхФорм,
			"НакладнаяТоварыUKREN",
			"Накладная на товары Corex UKREN",
			ПечатьНакладнаяТоварыUKREN(МассивОбъектов, ОбъектыПечати),
			,
			ИмяМакета);
	КонецЕсли;
	
КонецПроцедуры

Функция ПечатьНакладнаяТоварыUKREN(МассивОбъектов, ОбъектыПечати)
	Запрос = Новый Запрос;
	Запрос.Текст = "
	|ВЫБРАТЬ
	|	Товары.Ссылка КАК Ссылка,
	|	Товары.Ссылка.Номер КАК Номер,
	|	Товары.Ссылка.Дата КАК Дата,
	|	Товары.Ссылка.Организация КАК Организация,
	|	Товары.Ссылка.Контрагент КАК Контрагент,
	|	Товары.Ссылка.ВалютаДокумента КАК ВалютаДокумента,
	|	Товары.Ссылка.АдресДоставки КАК АдресДоставки,
	|	Товары.Ссылка.ДоговорКонтрагента.НаименованиеДляПечати КАК ДоговорКонтрагента,
	|	Товары.Номенклатура КАК Номенклатура,
	|	Товары.ЕдиницаИзмерения КАК ЕдиницаИзмерения,
	|	Товары.Количество КАК Количество,
	|	Товары.Цена КАК Цена,
	|	Товары.Сумма КАК Сумма,
	|	Товары.СуммаНДС КАК СуммаНДС
	|ИЗ
	|	Документ.РеализацияТоваровУслуг.Товары КАК Товары
	|

	|ГДЕ Товары.Ссылка = &ТекДок
	|";
	Запрос.УстановитьПараметр("ТекДок",МассивОбъектов[0]);
	ТабДокумент = Новый ТабличныйДокумент;
	КодЯзыкаПечать = "uk";
	КодЯзыкаПечатьEN = "en";
	Результат = Запрос.Выполнить().Выгрузить();
	Макет = ПолучитьМакет("НакладнаяТоварыUKREN");
	ОбластьЛоготип            = Макет.ПолучитьОбласть("ЛоготипИюль2020");
	ОбластьЗаголовок            = Макет.ПолучитьОбласть("Заголовок");
	//ОбластьШапка                = Макет.ПолучитьОбласть("Шапка");
	//ОбластьШапкаТаблицы         = Макет.ПолучитьОбласть("ШапкаТаблицы");
	//ОбластьСтрока               = Макет.ПолучитьОбласть("Строка");
	//ОбластьПодписи              = Макет.ПолучитьОбласть("Подписи");  
	СтруктураШапки = ОбщегоНазначения.СтрокаТаблицыЗначенийВСтруктуру(Результат[0]);
	СтруктураШапки.Вставить("ТекстЗаголовка",СформироватьЗаголовокДокумента(СтруктураШапки.Ссылка, НСтр("ru='Расходная накладная';uk='Видаткова накладна'",КодЯзыкаПечать),КодЯзыкаПечать));
	ТабДокумент.Вывести(ОбластьЛоготип);
	ТабДокумент.Вывести(ОбластьЗаголовок);
	
	//ЗаполнитьЗначенияСвойств(ОбластьШапка.Параметры,СтруктураШапки);
	//ТабДокумент.Вывести(ОбластьШапка);
	//ЗаполнитьЗначенияСвойств(ОбластьПодписи.Параметры,СтруктураШапки);
	//ТабДокумент.Вывести(ОбластьШапкаТаблицы);

	//Для каждого стр из Результат Цикл
	//	СК =  ОбщегоНазначения.СтрокаТаблицыЗначенийВСтруктуру(стр);
	//	ЗаполнитьЗначенияСвойств(ОбластьСтрока.Параметры,СК);
	//	ТабДокумент.Вывести(ОбластьСтрока);
	//КонецЦикла;	
	//ТабДокумент.Вывести(ОбластьПодписи);
    ТабДокумент.ОриентацияСтраницы = ОриентацияСтраницы.Ландшафт;
	Возврат ТабДокумент;
КонецФункции

Функция Транслит(Вход) 
	Коды = Новый Соответствие;
	Коды.Вставить("ё","yo");
	Коды.Вставить("Ё","Yo");
	Нач = КодСимвола("А");
	Англ = "A" "B" "V" "G" "D" "E" "Zh" "Z" "I" "Y" "K" "L" "M" "N" "O" "P" "R" "S" "T" "U" "F" "Kh" "Ts" "Ch" "Sh" "Shch" "" "Y" "" "E" "Yu" "Ya" "a" "b" "v" "g" "d" "e" "zh" "z" "i" "y" "k" "l" "m" "n" "o" "p" "r" "s" "t" "u" "f" "kh" "ts" "ch" "sh" "shch" "" "y" "" "e" "yu" "ya";
	Для К = Нач по КодСимвола("я") Цикл
		Коды.Вставить(Символ(К), СтрПолучитьСтроку(Англ, К - Нач + 1));
	КонецЦикла;
	Выход = "";
	Для К=1 по СтрДлина(Вход) Цикл
		Бкв = Сред(Вход,К,1);
		Зн = Коды.Получить(Бкв);
		Выход = Выход + ?(Зн = Неопределено, Бкв, Зн);
	КонецЦикла;
	Возврат Выход;
КонецФункции	

Функция ПолучитьСтруктуруСоответствиеUKREN()
	Соответствие = Новый Структура;
	Соответствие.Вставить("ТекстПоставщик","CONTRACTOR /
	|Виконавець");
	Соответствие.Вставить("ТекстПокупатель","Client /
	|Замовник");
	Соответствие.Вставить("ТекстДоговор","Сontract /
	|Договір");
	Соответствие.Вставить("ТекстПроект","Рroject /
	|Проект");
	Соответствие.Вставить("ТекстАдресаДоставки","Delivery address /
	|Адреса доставки");
	Соответствие.Вставить("ТекстТовар","Item / Товар");
	Соответствие.Вставить("ТекстКоличество","Q-ty / Кіл-сть");
	Соответствие.Вставить("ТекстЕдИзм","Unit / Од.");
	Соответствие.Вставить("ТекстЦена","Price with VAT / Ціна з ПДВ");
	Соответствие.Вставить("ТекстСумма"," Amount  with VAT / Сума з ПДВ");
	Соответствие.Вставить("ТекстВсего","Total / Всього:");
	Соответствие.Вставить("ТекстВсегоНДС","Including VAT: / У тому числі ПДВ:");
	
	Возврат Соответствие;
КонецФункции
