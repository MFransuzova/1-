// + АИГ Французова 19.01.2022 (Перенос данных трансляция)
&НаСервере
Процедура АИГ_СоздатьПроверитьФайлПротокола(СтруктураДанных)  Экспорт

	СтруктураДанных.Вставить("ТекстПротокола","");
	Год      = Год(ТекущаяДата());
	Год      = Формат(Год,"ЧЦ=4; ЧРГ=''; ЧГ=0");
	День     = Формат(День(ТекущаяДата()),  "ЧЦ=2; ЧВН=");
	Месяц    = Формат(Месяц(ТекущаяДата()), "ЧЦ=2; ЧВН=");
	ИмяФайла = Каталогвременныхфайлов()+Год+"-"+Месяц+"-"+День+".txt";
	СтруктураДанных.Вставить("ИмяФайла",ИмяФайла);
	
	ТекстПротокола = Новый ТекстовыйДокумент;
	//ТекстПротокола.Прочитать(ИмяФайла,КодировкаТекста.ANSI);
	ТекстПротокола.ДобавитьСтроку("===============================================");
	ТекстПротокола.ДобавитьСтроку("Протокол трансляции  за "+ ТекущаяДата()+".  Начало");
	//ТекстПротокола.Записать(ИмяФайла,КодировкаТекста.ANSI);
	//ДвоичныеДанные = Новый ДвоичныеДанные(ИмяФайла);
	//АдресФайлаПротокола = ПоместитьВоВременноеХранилище(ДвоичныеДанные, УникальныйИдентификатор);
	//СтруктураДанных.Вставить("АдресФайлаПротокола",АдресФайлаПротокола);
	СтруктураДанных.Вставить("ТекстПротокола",ТекстПротокола);
	
КонецПроцедуры
// - АИГ Французова 19.01.2022 (Перенос данных трансляция)
// + АИГ Французова 19.01.2022 (Перенос данных трансляция)
&НаСервере
Процедура АИГ_ЗаписатьФайлПротокола(СтруктураДанных)      Экспорт
	Если НЕ СтруктураДанных.Свойство("ТекстПротокола") Тогда
		Возврат;
	КонецЕсли;
	
	ТекстПротокола = СтруктураДанных.ТекстПротокола;
	ТекстПротокола.ДобавитьСтроку("Протокол трансляции  за "+ ТекущаяДата()+".  Конец");
	ТекстПротокола.ДобавитьСтроку("===============================================");
	ТекстПротокола.Записать(СтруктураДанных.ИмяФайла,КодировкаТекста.ANSI);
	СтруктураДанных.Вставить("ТекстПротокола",ТекстПротокола);
	
	ДвоичныеДанные = Новый ДвоичныеДанные(СтруктураДанных.ИмяФайла);
	АдресФайлаПротокола = ПоместитьВоВременноеХранилище(ДвоичныеДанные);//, УникальныйИдентификатор);
	СтруктураДанных.Вставить("АдресФайлаПротокола",АдресФайлаПротокола);
	
КонецПроцедуры
// - АИГ Французова 19.01.2022 (Перенос данных трансляция)
//_______________________ ВЫПОЛНЕНИЕ _______________________
// + АИГ Французова 19.01.2022 (Перенос данных трансляция)
&НаСервере
Процедура ВыполнитьПереносПроводок(СтруктураДанных)     Экспорт
	Организация = СтруктураДанных.Организация;
	Если ЗначениеЗаполнено(Организация.ГоловнаяОрганизация) Тогда
		СтруктураДанных.Вставить("Организация",Организация.ГоловнаяОрганизация);
	КонецЕсли;
	
КонецПроцедуры
// - АИГ Французова 19.01.2022 (Перенос данных трансляция)

//______________________ Запуск ____________
// + АИГ Французова 18.01.2022 (адаптация для 8.3 УФ)

&НаСервере
Процедура ВыполнениеОбработки(СтруктураДанных) Экспорт
	Если Не СтруктураДанных.Свойство("Организация") Тогда
		Возврат;
	КонецЕсли;
	
	АИГ_СоздатьПроверитьФайлПротокола(СтруктураДанных);
	
	СтруктураДанных.Вставить("ТолькоИзменения",Ложь);
	СтруктураДанных.Вставить("ДатаС",ДатаС);
	СтруктураДанных.Вставить("ДатаПо",ДатаПо);
	СтруктураДанных.Вставить("ДатаПо",ДатаПо);
	Если СтруктураДанных.ВидПереноса = 1 Тогда
		СтруктураДанных.Вставить("ТолькоИзменения",Истина) ;
	КонецЕсли; 
	ВыполнитьПереносПроводок(СтруктураДанных);
	
	АИГ_ЗаписатьФайлПротокола(СтруктураДанных);
	
КонецПроцедуры
// - АИГ Французова 18.01.2022 (адаптация для 8.3 УФ)
