// + АИГ Французова 06.01.2022 (Формирование Генератора отчетов)
&НаСервере
Процедура АИГ_СформироватьОтчет_ТабДокумент(СтруктураПараметров)
	АИГ_ИмяФайла = Каталогвременныхфайлов()+СокрЛП(ИмяПользователя()) +".mxl";
	ДвоичныеДанные = Объект.Ссылка.ТабДокумент.Получить();
	Если НЕ ДвоичныеДанные = Неопределено Тогда
		Если  НЕ ТипЗнч(ДвоичныеДанные) = Тип("ДвоичныеДанные") Тогда
			Возврат;
		КонецЕсли;
		
		ДвоичныеДанные.Записать(АИГ_ИмяФайла);
		АИГ_ТабДок_Хранилище.Прочитать(АИГ_ИмяФайла);
		АИГ_ТабДок_Хранилище.ФиксацияСверху = Объект.ФиксацияСверху;
		АИГ_ТабДок_Хранилище.ФиксацияСлева  = Объект.ФиксацияСлева;
	КонецЕсли;
	
КонецПроцедуры
// - АИГ Французова 06.01.2022 (Формирование Генератора отчетов)
// + АИГ Французова 30.11.2021-03.12.2021 (Формирование Генератора отчетов)
&НаСервере
Процедура СформироватьМеждународнаяОтчетностьРасшифровка(СтруктураПараметров)  
	
	Если НЕ ЗначениеЗаполнено(Объект.Ссылка) Тогда
		Возврат;
	КонецЕсли;
	ОбъектОтчет = РеквизитФормыВЗначение("Объект");
	Отчет = Отчеты.АИГ_ГенераторОтчетов_ОС.ПолучитьМакет("ОсновнаяСхемаКомпоновкиДанных");
	
    ЗаполнитьЗначенияСвойств(Отчет.Параметры,СтруктураПараметров);
	
	Настройки = Отчет.НастройкиПоУмолчанию;
	
	ДанныеРасшифровки = Новый ДанныеРасшифровкиКомпоновкиДанных;
	КомпоновщикМакета = Новый КомпоновщикМакетаКомпоновкиДанных;
	
	ПараметрВыполненногоДействия = Новый Структура;
	
	МакетКомпоновки = КомпоновщикМакета.Выполнить(Отчет, Настройки, ДанныеРасшифровки);
	
	ПроцессорКомпоновкиДанных = Новый ПроцессорКомпоновкиДанных;
	ПроцессорКомпоновкиДанных.Инициализировать(МакетКомпоновки, , ДанныеРасшифровки,Истина);    
	
	ДанныеРасшифровкиАдрес = ПоместитьВоВременноеХранилище(ДанныеРасшифровки, ЭтотОбъект.УникальныйИдентификатор);
	
	Результат = ЭтотОбъект.АИГ_ОтчетМеждународный;             // Табличный документ
	Результат.Очистить();
	ПроцессорВывода = Новый ПроцессорВыводаРезультатаКомпоновкиДанныхВТабличныйДокумент;
	ПроцессорВывода.УстановитьДокумент(Результат);
	ПроцессорВывода.Вывести(ПроцессорКомпоновкиДанных);
	ЗначениеВРеквизитФормы(ОбъектОтчет,"Объект");
КонецПроцедуры
// - АИГ Французова 30.11.2021 (Формирование Генератора отчетов)

// + АИГ Французова 29.11.2021 (Формирование Генератора отчетов)

&НаКлиенте
Процедура АИГ_ПериодОчтетаПриИзменении(Элемент)
	СтруктураПечати = Новый Структура;
    СформироватьМеждународнаяОтчетностьРасшифровка(СтруктураПечати);
КонецПроцедуры
// - АИГ Французова 29.11.2021 (Формирование Генератора отчетов)

// + АИГ Французова 29.11.2021 (Формирование Генератора отчетов)
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Если НЕ ЗначениеЗаполнено(Организация) Тогда
		Организация = БухгалтерскийУчетПереопределяемый.ПолучитьЗначениеПоУмолчанию("ОсновнаяОрганизация");
	КонецЕсли;
	Если НЕ ЗначениеЗаполнено(ЕдиницаИзмерения) Тогда
		//ЕдиницаИзмерения = Справочники.КлассификаторЕдиницИзмерения.НайтиПоКоду("001");
		ЕдиницаИзмерения = ПредопределенноеЗначение("Перечисление.ПорядкиОкругленияОтчетности.Окр1");
	КонецЕсли;      
	Если НЕ ЗначениеЗаполнено(Объект.Ответственный) Тогда
		Объект.Ответственный = Пользователи.ТекущийПользователь();
	КонецЕсли;
	Если НЕ ЗначениеЗаполнено(Объект.ФиксацияСверху) Тогда
		Объект.ФиксацияСверху = 4;
	КонецЕсли;
	Если НЕ ЗначениеЗаполнено(Объект.ФиксацияСлева) Тогда
		Объект.ФиксацияСлева = 1;
	КонецЕсли;

	Если НЕ ЗначениеЗаполнено(АИГ_ПериодОчтета) Тогда
		АИГ_ПериодОчтета.ДатаНачала    = НачалоМесяца(ТекущаяДата());
		АИГ_ПериодОчтета.ДатаОкончания = КонецМесяца(ТекущаяДата());
		СтруктураПараметров = Новый Структура;
		СтруктураПараметров.Вставить("ОбъектСсылка", Объект.Ссылка);
		СтруктураПараметров.Вставить("НачалоПериода",НачалоДня(АИГ_ПериодОчтета.ДатаНачала));
		СтруктураПараметров.Вставить("КонецПериода",КонецДня(АИГ_ПериодОчтета.ДатаОкончания));
		СтруктураПараметров.Вставить("НачалоПериодаДата",НачалоДня(АИГ_ПериодОчтета.ДатаНачала));
		СтруктураПараметров.Вставить("КонецПериодаДата",КонецДня(АИГ_ПериодОчтета.ДатаОкончания));
		СтруктураПараметров.Вставить("Организация",Организация);
		АИГ_СформироватьОтчет_ТабДокумент(СтруктураПараметров);
		СформироватьМеждународнаяОтчетностьРасшифровка(СтруктураПараметров);
	КонецЕсли;
КонецПроцедуры
// - АИГ Французова 29.11.2021 (Формирование Генератора отчетов)
// + АИГ Французова 06.01.2022 (Формирование Генератора отчетов)
&НаСервере
Процедура АИГ_ЗаписатьДанныеОтчета()
	АИГ_ТабДок_Хранилище.Записать(АИГ_ИмяФайла,ТипФайлаТабличногоДокумента.MXL);
	ДвоичныйФайл = Новый ХранилищеЗначения(Новый ДвоичныеДанные(АИГ_ИмяФайла),Новый СжатиеДанных(9));   
	АдресВременногоХранилища = ПоместитьВоВременноеХранилище(ДвоичныйФайл);
	ТекОбъект = РеквизитФормыВЗначение("Объект");
	ТекОбъект.ТабДокумент = ПолучитьИзВременногоХранилища(АдресВременногоХранилища);
	УдалитьИзВременногоХранилища(АдресВременногоХранилища);
	ЗначениеВРеквизитФормы(ТекОбъект, "Объект");
КонецПроцедуры
// - АИГ Французова 06.01.2022 (Формирование Генератора отчетов)
// + АИГ Французова 06.01.2022 (Формирование Генератора отчетов)
&НаКлиенте
Процедура ПередЗаписью(Отказ, ПараметрыЗаписи) 
	ПоказатьВопрос(Новый ОписаниеОповещения("АИГ_ЗаписатьДанныеОтчетаКлиент", ЭтотОбъект), "Записать изменения Отчета?", РежимДиалогаВопрос.ДаНет);
КонецПроцедуры
// - АИГ Французова 06.01.2022 (Формирование Генератора отчетов)
// + АИГ Французова 06.01.2022 (Формирование Генератора отчетов)

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	Элементы.АИГ_ТабДок_Хранилище.Редактирование = Истина;
КонецПроцедуры
// - АИГ Французова 06.01.2022 (Формирование Генератора отчетов)
// + АИГ Французова 06.01.2022 (Формирование Генератора отчетов)

&НаКлиенте
Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	//Если Тогда
	//	АИГ_ЗаписатьДанныеОтчета();
	//КонецЕсли;
	
КонецПроцедуры
// - АИГ Французова 06.01.2022 (Формирование Генератора отчетов)
// + АИГ Французова 06.01.2022 (Формирование Генератора отчетов)

&НаКлиенте
Процедура АИГ_ЗаписатьДанныеОтчетаКлиент(РезультатВопроса, ПараметрыЗаписи) Экспорт
	Если РезультатВопроса = КодВозвратаДиалога.Да Тогда
		АИГ_ЗаписатьДанныеОтчета();
	КонецЕсли;
КонецПроцедуры

// - АИГ Французова 06.01.2022 (Формирование Генератора отчетов)

