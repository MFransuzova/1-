// + АИГ Французова 12.05.2022 17:21:28 (Доработка: рекламация)
&НаСервере
Процедура ЗаполнитьМассивРеестра(СтруктураПараметров)
	Запрос = Новый Запрос;
	Запрос.Текст = "
	
	|";
	Результат  =  Запрос.Выполнить().Выгрузить(); 
	Массив = Новый Массив;
	Для каждого стр из Результат Цикл
		Массив.Добавить(стр.Заказ);
	КонецЦикла;
КонецПроцедуры

// + АИГ Французова 12.05.2022 17:21:18 (Доработка: рекламация)

&НаСервере
Процедура ОбновитьРеестр()
	Отчет.РеестрПретензий.Очистить();
	СтруктураПараметров = Новый Структура;
	ЗаполнитьМассивРеестра(СтруктураПараметров);
	
КонецПроцедуры
// - АИГ Французова 12.05.2022 17:21:22 (Доработка: рекламация)
// + АИГ Французова 12.05.2022 16:53:02 (Доработка: рекламация)

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	
	Параметры.СформироватьПриОткрытии = Истина;
	// + АИГ Французова 09.06.2022 6:00:15 (Доработка: рекламация)
	ОбновлениеТаблиц();
	// - АИГ Французова 09.06.2022 6:00:19 (Доработка: рекламация)
КонецПроцедуры

// - АИГ Французова 12.05.2022 16:53:07 (Доработка: рекламация)
// + АИГ Французова 12.05.2022 17:18:46 (Доработка: рекламация)

&НаКлиенте
Процедура ПретензииВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	ОбновитьРеестр();
КонецПроцедуры
// - АИГ Французова 12.05.2022 17:18:50 (Доработка: рекламация)
// + АИГ Французова 30.05.2022 14:00:51 (Доработка: рекламация)
&НаСервере
Процедура ВывестиДанныеОтчета()  
	// + АИГ Французова 01.06.2022 17:28:40 (Доработка: рекламация)
	МассивУдаляемых = Новый Массив;
	Для каждого эл из  Отчет.КомпоновщикНастроек.Настройки.Отбор.Элементы Цикл 
		МассивУдаляемых.Добавить(эл);
	КонецЦикла;
	Для каждого эл из МассивУдаляемых Цикл
		Отчет.КомпоновщикНастроек.Настройки.Отбор.Элементы.Удалить(эл);
	КонецЦикла;
	
	Если ВариантыОтчетовВывод = 1 Тогда
		ЭлементОтбора = Отчет.КомпоновщикНастроек.Настройки.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
		ЭлементОтбора.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("Состояние");
		ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.НеСодержит;
		ЭлементОтбора.ПравоеЗначение = "Новая претензия";
		ЭлементОтбора.Использование = Истина;
		ЭлементОтбора1 = Отчет.КомпоновщикНастроек.Настройки.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
		ЭлементОтбора1.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("Отправлена");
		ЭлементОтбора1.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно;
		ЭлементОтбора1.ПравоеЗначение = Ложь;
		ЭлементОтбора1.Использование = Истина;

	ИначеЕсли ВариантыОтчетовВывод = 2 Тогда
		ЭлементОтбора = Отчет.КомпоновщикНастроек.Настройки.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
		ЭлементОтбора.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("Отправлена");
		ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно;
		ЭлементОтбора.ПравоеЗначение = Истина;
		ЭлементОтбора.Использование = Истина;
	ИначеЕсли ВариантыОтчетовВывод = 3 Тогда
		ЭлементОтбора = Отчет.КомпоновщикНастроек.Настройки.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
		ЭлементОтбора.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("Состояние");
		ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.Содержит;
		ЭлементОтбора.ПравоеЗначение = "Новая претензия";
		ЭлементОтбора.Использование = Истина;

	ИначеЕсли ВариантыОтчетовВывод = 4 Тогда
		ЭлементОтбора = Отчет.КомпоновщикНастроек.Настройки.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
		ЭлементОтбора.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("Оплачена");
		ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно;
		ЭлементОтбора.ПравоеЗначение = Истина;
		ЭлементОтбора.Использование = Истина;
	КонецЕсли;
	
	ЭтотОбъект.СкомпоноватьРезультат(); 
	// - АИГ Французова 01.06.2022 17:28:45 (Доработка: рекламация)
	// + АИГ Французова 02.06.2022 12:41:02 (Доработка: рекламация)
	//ТЗ =  ПреобразоватьТабличныйДокументВТаблицуЗначений(Результат);
	//Отчет.Претензии.Очистить();
	//Для каждого стр из ТЗ Цикл
	//	нс = Отчет.Претензии.Добавить();
	//	ЗаполнитьЗначенияСвойств(нс,стр);
	//КонецЦикла;
	
	// - АИГ Французова 02.06.2022 12:41:04 (Доработка: рекламация)
КонецПроцедуры

// - АИГ Французова 30.05.2022 14:00:54 (Доработка: рекламация)
// + АИГ Французова 02.06.2022 12:40:36 (Доработка: рекламация)
Функция ПреобразоватьТабличныйДокументВТаблицуЗначений(ТабДокумент)
	
	Построитель = Новый ПостроительОтчета;
	Построитель.ИсточникДанных = Новый ОписаниеИсточникаДанных(ТабДокумент.Область(1, 1, ТабДокумент.ВысотаТаблицы, 7));
	Построитель.Выполнить();
	ТабЗначений = Построитель.Результат.Выгрузить();
	
	Возврат ТабЗначений
	
КонецФункции
// - АИГ Французова 02.06.2022 12:40:38 (Доработка: рекламация)
// + АИГ Французова 30.05.2022 13:52:01 (Доработка: рекламация)

&НаКлиенте
Процедура ВариантыОтчетовВыводПриИзменении(Элемент)
	ВывестиДанныеОтчета();
	
КонецПроцедуры
// - АИГ Французова 30.05.2022 13:52:05 (Доработка: рекламация)
// + АИГ Французова 01.06.2022 17:03:24 (Доработка: рекламация)

&НаКлиенте
Процедура ПоказатьРеестр(Команда)
	СтруктураПараметров = Новый Структура;
	ОткрытьФорму("РегистрСведений.КК_РеестрПретензий.Форма.АИГ_ФормаСписка_УФ",СтруктураПараметров,ЭтотОбъект,,,,,);
КонецПроцедуры
// - АИГ Французова 01.06.2022 17:03:29 (Доработка: рекламация)
// + АИГ Французова 09.06.2022 6:00:49 (Доработка: рекламация)
&НаСервере
Процедура ОбновлениеТаблиц()
	Отчет.Претензии.Очистить();
	Отчет.РеестрПретензий.Очистить();
	Настройки = Отчет.КомпоновщикНастроек.ПолучитьНастройки();
	КомпоновщикМакета = Новый КомпоновщикМакетаКомпоновкиДанных;
	МакетКомпоновки = КомпоновщикМакета.Выполнить(Отчет.СхемаКомпоновкиДанных,Отчет.КомпоновщикНастроек.ПолучитьНастройки(), ДанныеРасшифровки);	ПроцессорКомпоновкиДанных = Новый ПроцессорКомпоновкиДанных;
	ПроцессорКомпоновкиДанных.Инициализировать(МакетКомпоновки);
	ПроцессорВывода = Новый ПроцессорВыводаРезультатаКомпоновкиДанныхВКоллекциюЗначений;
	ПроцессорВывода.УстановитьОбъект(Результат);	
	ПроцессорВывода.Вывести(ПроцессорКомпоновкиДанных, Истина);
КонецПроцедуры
// - АИГ Французова 09.06.2022 6:01:02 (Доработка: рекламация)
