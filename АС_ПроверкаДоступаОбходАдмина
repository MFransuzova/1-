//+СА Французова Мария 2021-09-14 Задача #20044 Запрет на редактирование свойств номенклатуры, у которой получены GTIN 
Функция СА_ЕстьРоль(ИмяРоли, Пользователь = Неопределено) Экспорт

	Если Пользователь = Неопределено Тогда
		Пользователь = ПользователиКлиентСервер.ТекущийПользователь();
	КонецЕсли;
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	1 
		|ИЗ
		|	Справочник.ГруппыДоступа.Пользователи КАК ГруппыДоступаПользователи
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ПрофилиГруппДоступа.Роли КАК ПрофилиГруппДоступаРоли
		|		ПО ГруппыДоступаПользователи.Ссылка.Профиль = ПрофилиГруппДоступаРоли.Ссылка
		|ГДЕ
		|	ПрофилиГруппДоступаРоли.Роль.Имя = &Роль
		|	И ГруппыДоступаПользователи.Пользователь = &Пользователь";
	
	Запрос.УстановитьПараметр("Пользователь", Пользователь);
	Запрос.УстановитьПараметр("Роль", ИмяРоли);
	
	УстановитьПривилегированныйРежим(Истина);
	РезультатЗапроса = Запрос.Выполнить();
	УстановитьПривилегированныйРежим(Ложь);
	
	Если РезультатЗапроса.Пустой() Тогда
		Возврат Ложь;		
	Иначе	
		Возврат Истина;		
	КонецЕсли;
	
КонецФункции
//-СА Французова Мария 2021-09-14 Задача #20044 Запрет на редактирование свойств номенклатуры, у которой получены GTIN 
//+СА Французова Мария 2021-09-10 Задача #20044 Запрет на редактирование свойств номенклатуры, у которой получены GTIN 
&НаСервере
Процедура СА_ПроверкаДоступа()
	//	1) Проверку на запрет сделать для следующих полей карточки номенклатуры:
	МассивЭлементов = Новый Массив;
	МассивЭлементов.Добавить("_АртикулПроизводителя");                 //- Артикул
	МассивЭлементов.Добавить("_НаименованиеПроизводителя");            //- Наименование
	МассивЭлементов.Добавить("_КодТНВЭД");               //- Код ТНВЭД
	МассивЭлементов.Добавить("_СтранаПроисхождения");   //- Страна
	МассивЭлементов.Добавить("_Производитель");        //- Производитель
	МассивЭлементов.Добавить("_Категория");             //- Категория
	МассивЭлементов.Добавить("_ГруппаТоваров");         //- Группа товаров
	МассивЭлементов.Добавить("_НаименованиеТовара");  //- Наименование товара
	МассивЭлементов.Добавить("_Модель");             //- Модель
	МассивЭлементов.Добавить("_Цвет");               //- Цвет
	МассивЭлементов.Добавить("_ЦветРусский");         //- Цвет по русски:
	МассивЭлементов.Добавить("_Верх");             //- Материал верха
	МассивЭлементов.Добавить("_Подкладка");      //- Материал подкладки
	МассивЭлементов.Добавить("_Стелька");      //- Материал стельки
	МассивЭлементов.Добавить("_Подошва");      //- Материал подошвы
	МассивЭлементов.Добавить("_МеховыеДетали");   //- Меховые детал
	МассивЭлементов.Добавить("Характеристики_номенклатуры"); //- Размер в штихмассовой системе (Запрет на редактирование Характеристик номенклатуры")  // Спр.ХарактеристикиНоменклатуры рек-т  _РазмерВШтихмассовойСистемеGS1
	Структура= Новый Структура;
	Структура.Вставить("Объект",Объект.Ссылка);
	ВСистемеGTIN = Справочники.Номенклатура.СА_ПроверкаВСистемеGTIN(Структура);	
	Пользователь = ПользователиИнформационнойБазы.ТекущийПользователь();

	Если ВСистемеGTIN Тогда
		Если НЕ Метаданные.Роли.Найти("СА_РедактированиеGTIN")= Неопределено Тогда
			Если СА_ЕстьРоль("СА_РедактированиеGTIN") Тогда 
				Возврат;
			КонецЕсли;
		КонецЕсли;
		
		Для каждого эл из МассивЭлементов Цикл
			Если НЕ эл = "Характеристики_номенклатуры" Тогда
				Если Элементы.Найти(эл) = Неопределено Тогда
					Продолжить;
				КонецЕсли;
				Элементы[эл].Доступность = Ложь;	
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;	
КонецПроцедуры
//-СА Французова Мария 2021-09-10 Задача #20044 Запрет на редактирование свойств номенклатуры, у которой получены GTIN 
