// + АИГ Французова 27.12.2021 (Общие функции)
&НаСервере
Функция Сч(к)   Экспорт
	к = к+1;
	Возврат к;	
КонецФункции

&НаСервере
Функция ПоискВДвумерномМассиве(Мас,где,что,искомое)  Экспорт
	зн = "";
	Для каждого эл из Мас Цикл
		Если Найти(где,эл[что])>0 Тогда
			зн = эл[искомое]
		КонецЕсли;	
	КонецЦикла;	
	Возврат зн;
КонецФункции	

&НаСервере
Процедура ВставитьВМассив(М,Сч,зн0,зн1)    Экспорт
	М[Сч][0]=зн0;
	М[Сч][1]=зн1;
КонецПроцедуры

&НаСервере
Функция  СтрокуТаблицыВСтруктуру(ОбъектТаблица,ТекСтрока)    Экспорт
	Структура = Новый Структура;
	Для каждого Колонка Из ОбъектТаблица.Колонки Цикл
		Структура.Вставить(Колонка.Имя, ТекСтрока[Колонка.Имя]);
	КонецЦикла ;
	Возврат Структура;
КонецФункции

&НаСервере
Функция СвернутьМассив(Массив)      Экспорт
	НовыйМассив = Новый Массив; 
	СоответствиеТ = Новый Соответствие;
	Для каждого ЭлементМассива Из Массив Цикл
		Если ЗначениеЗаполнено(ЭлементМассива) Тогда
			СоответствиеТ.Вставить(ЭлементМассива,ЭлементМассива);
		КонецЕсли;
	КонецЦикла;
	Для каждого КлючИЗначение Из СоответствиеТ Цикл
		НовыйМассив.Добавить(КлючИЗначение.Значение);
	КонецЦикла;
	Возврат НовыйМассив;
КонецФункции

&НаСервере
Функция МаксимальноеЗначениеМассива(Массив) Экспорт
	Если Массив.Количество()=0 Тогда
		Возврат Неопределено;
	КонецЕсли;	
	Макс = Массив[0];
	Для каждого эл из Массив Цикл
		Если эл>Макс Тогда
			Макс = эл;
		КонецЕсли;
	КонецЦикла;	
	Возврат Макс;	
КонецФункции	


&НаСервере
Функция МинимальноеЗначениеМассива(Массив) Экспорт
	Если Массив.Количество()=0 Тогда
		Возврат Неопределено;
	КонецЕсли;	
	Мин = Массив[0];
	Для каждого эл из Массив Цикл
		Если эл<Мин Тогда
			Макс = эл;
		КонецЕсли;
	КонецЦикла;	
	Возврат Мин;	
КонецФункции


&НаСервере
Функция РеквизитыОбъектаВСтруктуру(ОбъектМенять) Экспорт
	Структура  = Новый Структура;
	Для каждого рек из ОбъектМенять.Метаданные().Реквизиты Цикл
		Структура.Вставить(рек.Имя,ОбъектМенять[рек.Имя]);
	КонецЦикла;
	Возврат Структура;
КонецФункции

&НаСервере
Функция ТаблицуЗначенийВМассив(ТЗ) Экспорт
	Массив = Новый Массив;
	Для каждого стр из ТЗ Цикл
		СК = ОбщегоНазначения.СтрокаТаблицыЗначенийВСтруктуру(стр);
		Массив.Добавить(СК);
	КонецЦикла;	
	Возврат Массив;	
КонецФункции

&НаСервере
Функция СтрокуВЧисло(СтрокаСЧислом)  Экспорт
    МассивСтрок = СтрРазделить(СтрокаСЧислом, "0123456789", Ложь);
    Для Каждого ТекСтрока из МассивСтрок Цикл 
        СтрокаСЧислом = СтрЗаменить(СтрокаСЧислом, ТекСтрока, "");
    КонецЦикла;
    
    Возврат Число(СтрокаСЧислом);
КонецФункции

&НаСервере
Функция УбратьНули(НомерСтрокой)    Экспорт
    Если Лев(НомерСтрокой, 1) = "0" Тогда
        Возврат УбратьНули(Прав(НомерСтрокой, СтрДлина(НомерСтрокой) - 1)); 
    Иначе
        Возврат НомерСтрокой;
    КонецЕсли;
КонецФункции
&НаСервере

Функция ПреобразоватьТЗвТЗсОписаниемТипов(ТЗ)  Экспорт
	ТЗ_ = Новый ТаблицаЗначений;
	Для каждого колонка из ТЗ.Колонки Цикл
		ОписаниеТипа = Неопределено; 
		Если колонка.Имя = "Номенклатура" Тогда   
			ОписаниеТипа = Новый ОписаниеТипов("СправочникСсылка.Номенклатура");
		ИначеЕсли колонка.Имя = "ЦенаЗаЕдиницу" Тогда
			ОписаниеТипа = Новый  ОписаниеТипов("Число");
		ИначеЕсли колонка.Имя = "Отменено" Тогда	
			ОписаниеТипа = Новый  ОписаниеТипов("Булево");
        ИначеЕсли колонка.Имя = "СуммаСНДС" Тогда
			ОписаниеТипа = Новый  ОписаниеТипов("Число");

		//Иначе
		//	ОписаниеТипа = Новый  ОписаниеТипов("Строка");
		КонецЕсли;
		
		Если НЕ ОписаниеТипа = Неопределено Тогда
			ТЗ_.Колонки.Добавить(колонка.Имя,ОписаниеТипа); 
		КонецЕсли;
	КонецЦикла;
	
	Для каждого стр из ТЗ Цикл
		СК = ОбщегоНазначения.СтрокаТаблицыЗначенийВСтруктуру(стр);
		нс = ТЗ_.Добавить();
		ЗаполнитьЗначенияСвойств(нс,СК);
	КонецЦикла;
	
	Возврат ТЗ_;
КонецФункции

&НаСервере
Функция ТипыЧисло()
	Массив = Новый Массив;
	Массив.Добавить("Количество");
	Массив.Добавить("РасходТоплива");
	Массив.Добавить("Сумма");
	Массив.Добавить("Цена");
	Массив.Добавить("Приход");
	Массив.Добавить("Расход");  
	Массив.Добавить("Площадь");
	Массив.Добавить("КоличествоТМЦ");
	Массив.Добавить("ЦенаштукибезНДС");
	Массив.Добавить("ЦенаштукисНДС");
	Массив.Добавить("СуммабезНДС");
	Массив.Добавить("СуммасНДС");
	
	Возврат Массив;
КонецФункции
&НаСервере
Функция ТипыДата()
	Массив = Новый Массив;
	Массив.Добавить("Дата");
	Массив.Добавить("ДатаОперацииГСМ");
	Массив.Добавить("ДатаОперацииТМЦ");
    Массив.Добавить("Датазаказа");
	Массив.Добавить("Датапоступлениязаказа");
	Возврат Массив;
КонецФункции
&НаСервере
Функция СоответствиеТипов()
	Соответствие = Новый Соответствие;
	Соответствие.Вставить("Номенклатура",Новый ОписаниеТипов("СправочникСсылка.Номенклатура"));
	Соответствие.Вставить("Контрагент",Новый ОписаниеТипов("СправочникСсылка.Контрагенты"));
	Соответствие.Вставить("Дата",Новый ОписаниеТипов("Дата"));
КонецФункции	
&НаСервере
Функция МассивВТаблицуЗначений(Мас)    Экспорт 
	ТЗ = Новый ТаблицаЗначений;
	ЧисловойТип = ТипыЧисло();
	ДатаТип = ТипыДата();
	ТипыДанных = СоответствиеТипов();
	Для каждого эл из Мас Цикл
		Если НЕ ТипЗнч(эл) = Тип("Структура") Тогда
			Прервать;
		КонецЕсли;
		Для каждого стр из эл Цикл
			Если ТЗ.Колонки.Найти(стр.Ключ)=Неопределено Тогда
				Если НЕ ЧисловойТип.Найти(стр.Ключ) = Неопределено Тогда  
					ТипК = Новый ОписаниеТипов("Число");
				ИначеЕсли НЕ ДатаТип.Найти(стр.Ключ) = Неопределено Тогда
					ТипК = Новый ОписаниеТипов("Дата");
					//ИначеЕсли НЕ ТипыДанных.Найти(стр.Ключ) = Неопределено Тогда
					//	ТипК = ТипыДанных.Найти(стр.Ключ);					
				Иначе
					КвалификаторыСтроки = Новый КвалификаторыСтроки(100);
					ТипК = Новый ОписаниеТипов("Строка",,КвалификаторыСтроки);
				КонецЕсли;
				
				ТЗ.Колонки.Добавить(стр.Ключ,ТипК);
			Иначе
				Если НЕ ДатаТип.Найти(стр.Ключ) = Неопределено Тогда
					Если 	ТипЗнч(эл[стр.Ключ])= Тип("Строка") Тогда
						Попытка
							эл[стр.Ключ] = Дата(эл[стр.Ключ]+" 00:00:00");
						Исключение
						КонецПопытки;
					КонецЕсли;
				КонецЕсли;
			КонецЕсли;
		КонецЦикла;
		нс = ТЗ.Добавить();
		Если НЕ ЧисловойТип.Найти(стр.Ключ) = Неопределено Тогда	
			ЗначениеЧисла = СтрЗаменить(эл[стр.Ключ],Символы.НПП,"")  ;
			ЗначениеЧисла = СтрЗаменить(ЗначениеЧисла," ","");  
			эл[стр.Ключ] = Число(ЗначениеЧисла);
		КонецЕсли;
		ЗаполнитьЗначенияСвойств(нс,эл);
	КонецЦикла;
	
	Возврат ТЗ;	

КонецФункции
// - АИГ Французова 27.12.2021 (Общие функции)

// + АИГ Французова 27.12.2021 (Общие процедуры)
&НаСервере
Процедура ТабличныйДокумент_ТаблицаЗначений(ТабДокумент,АдресТЗ,ОбластьЯчеек)    Экспорт
	
	// Создаем описание источника данных на основании области ячеек табличного документа. 
	ИсточникДанных = Новый ОписаниеИсточникаДанных(ОбластьЯчеек);
		
	// Создаем объект для интеллектуального построения отчетов,
	// указываем источник данных и выполняем построение отчета.
	ПостроительОтчета = Новый ПостроительОтчета;	
	ПостроительОтчета.ИсточникДанных = ИсточникДанных;
	ПостроительОтчета.Выполнить();
	
	// Результат выгружаем в таблицу значений.
	ТабЗначений = ПостроительОтчета.Результат.Выгрузить();

	АдресТЗ =  ПоместитьВоВременноеХранилище(ТабЗначений);
КонецПроцедуры	
// - АИГ Французова 27.12.2021 (Общие процедуры)
