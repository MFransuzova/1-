//+ ДБ Французова Французова 06.12.2023 (#4789 прикрепление файлов)

&НаСервере
Процедура ДБ_ПриСозданииНаСервереПосле(Отказ, СтандартнаяОбработка)

	#Область УниверсальныеМеханизмы
	
	// СтандартныеПодсистемы.РаботаСФайлами
	ПараметрыГиперссылки = РаботаСФайлами.ГиперссылкаФайлов();
	ПараметрыГиперссылки.Размещение = "КоманднаяПанель";
	РаботаСФайлами.ПриСозданииНаСервере(ЭтотОбъект, ПараметрыГиперссылки);
	// Конец СтандартныеПодсистемы.РаботаСФайлами

	СобытияФорм.ПриСозданииНаСервере(ЭтотОбъект, Отказ, СтандартнаяОбработка);

	#КонецОбласти

КонецПроцедуры
//- ДБ Французова Французова 06.12.2023 (#4789 прикрепление файлов) 
//+ ДБ Французова Французова 06.12.2023 (#4789 прикрепление файлов)
&НаСервере
Процедура ДБ_СоздатьЭлементыФормы()       
	ИмяКоманды = "ПрисоединенныеФайлы";
	
	КомандаПрисоединенныеФайлы = ЭтаФорма.Команды.Найти(ИмяКоманды);
	Если ТипЗнч(КомандаПрисоединенныеФайлы) = Тип("КомандаФормы") Тогда
		
		СсылкаНаФайлы = Элементы.Добавить("СсылкаНаФайлы",Тип("ДекорацияФормы"),);//Элементы.ФормаКоманднаяПанель);
		СсылкаНаФайлы.Вид = ВидДекорацииФормы.Ги;
		СсылкаНаФайлы.ВертикальноеПоложение    = ВертикальноеПоложениеЭлемента.Верх;
		СсылкаНаФайлы.Заголовок                = "Файлы";
		СсылкаНаФайлы.АвтоМаксимальнаяШирина   = Ложь;
		СсылкаНаФайлы.МаксимальнаяШирина       = 100;
		СсылкаНаФайлы.РастягиватьПоГоризонтали = Ложь;
		СсылкаНаФайлы.РастягиватьПоВертикали   = Ложь;
		СсылкаНаФайлы.Подсказка                = "Прикрепленные файлы";  
	КонецЕсли;
КонецПроцедуры

//- ДБ Французова Французова 06.12.2023 (#4789 прикрепление файлов) 
//+ ДБ Французова Французова 06.12.2023 (#4789 прикрепление файлов)

&НаСервере
Процедура ДБ_СоздатьКомандыФормы()   
	ИмяКоманды = "ПрисоединенныеФайлы";
	
	КомандаПрисоединенныеФайлы = ЭтаФорма.Команды.Найти(ИмяКоманды);
	
	Если ТипЗнч(КомандаПрисоединенныеФайлы) = Тип("КомандаФормы") Тогда
		Возврат;
	КонецЕсли;
	
	КомандаФормы = ЭтаФорма.Команды.Добавить(ИмяКоманды);
	КомандаФормы.Действие = "Подключаемый_ОткрытьПрисоединенныеФайлы";
	КомандаФормы.Заголовок = "Присоединенные файлы";
	КомандаФормы.ИзменяетСохраняемыеДанные = Ложь;
	КомандаФормы.Отображение = ОтображениеКнопки.Картинка;
	КомандаФормы.Картинка = БиблиотекаКартинок.Скрепка;
	
	// Кнопка "со скрепкой" добавляется в конец командной панели формы.
	Группа = ЭтаФорма.Элементы.Вставить("ГруппаПрисоединенныеФайлы",
	Тип("ГруппаФормы"), ЭтаФорма.Элементы.ФормаКоманднаяПанель);
	Группа.Вид = ВидГруппыФормы.ГруппаКнопок;
	
	Кнопка = ЭтаФорма.Элементы.Добавить("ПрисоединенныеФайлы",
	Тип("КнопкаФормы"), ЭтаФорма.Элементы.ГруппаПрисоединенныеФайлы);
	Кнопка.ИмяКоманды = ИмяКоманды;
	Кнопка.Заголовок = "";
	

КонецПроцедуры

//- ДБ Французова Французова 06.12.2023 (#4789 прикрепление файлов)





Данная статья поможет добавить "скрепку", т.е. возможность пользоваться функционалом БСП для присоединения файлов к любому документу.
Ниже описан порядок действий для добавления "скрепки" (присоединение файлов) к новому документу "НашНовыйДокумент" (как пример).

1. Копируем справочник с наименованием содержащим на конце словосочетание "ПрисоединенныеФайлы". Например "АвансовыйОтчетПрисоединенныеФайлы".

2. Меняем наименование так, чтобы префикс точно соответствовал наименованию документа, а окончание содержало "ПрисоединенныеФайлы". В нашем случае: "НашНовыйДокументПрисоединенныеФайлы".

3. Меняем ТИП у реквизита "ВладелецФайла" справочника "НашНовыйДокументПрисоединенныеФайлы" на "НашНовыйДокумент".

4. Включаем в состав определяемых типов "ПрисоединенныйФайл" и "ПрисоединенныйФайлОбъект" наш новый справочник "НашНовыйДокументПрисоединенныеФайлы".

5. Расширим состав определяемого типа "ВладелецПрисоединенныхФайлов" нашим документом (ДокументСсылка) "НашНовыйДокумент".

6. Расширим состав типов свойства "Источник" у подписки "ПереопределитьПолучаемуюФормуПрисоединенногоФайла", включив в него справочник "НашНовыйДокументПрисоединенныеФайлы".

7. Расширим состав типов свойства "Источник" подписки УстановитьПометкуУдаленияПрисоединенныхФайловДокументов, включив в него наш новый документ (ДокументОбъект) "НашНовыйДокументПрисоединенныеФайлы".

8. Расширим состав общей команды "ПрисоединенныеФайлы" и "ПрисоединенныеФайлыБП", включив в него наш новый документ (ДокументСсылка).

Если необходимо добавить "Скрепку" на форму списка (в типовом варианте должна добавиться автоматически), чтобы картинка значения появлялась при наличии прикрепленных файлов у документа (строка в списке), то выполняем следующие действия:

1. В форме списка, у реквизита "Список" имеющего тип "ДинамическийСписок" выставляем галку "ПроизвольныйЗапрос", после чего открываем настройку списка (в там же в свойствах) и добавляем в блок "Выбрать":

НаличиеФайлов.ЕстьФайлы КАК ЕстьФайлы

а в блок "ИЗ" :

{ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.НаличиеФайлов КАК НаличиеФайлов
        ПО НашНовыйДокумент.Ссылка = НаличиеФайлов.ОбъектСФайлами}

2. После того, как поправили запрос, в реквизитах списка появится "ЕстьФайлы". Перетаскиваем реквизит в табличное поле и указываем в свойствах:

- Вид: "Поле картинки";

- Положение заголовка: "Нет";

- Картинка значений: "Скрепка";

- Картинка шапки: "Скрепка".
