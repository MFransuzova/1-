&НаСервере
Процедура ВыполнитьСформированиеНаСервере(Структура)  
	Сообщение = Новый СообщениеПользователю;
	Если НЕ ЗначениеЗаполнено(ПериодОбработки) Тогда  
		Сообщение.Текст = "Необходимо заполнить период!";
		Сообщение.Сообщить();
		Возврат;
	КонецЕсли;      
	ТЗ = Объект.ДоговорыАренды.Выгрузить();
	МассивДоговоров = ТЗ.ВыгрузитьКолонку("ДоговорАренды");
	Структура.Вставить("ДатаН",ПериодОбработки.ДатаНачала);    
	Структура.Вставить("ДатаК",ПериодОбработки.ДатаОкончания);
	Структура.Вставить("МассивДоговоров",МассивДоговоров);
	//СписокГрафиковОплатАренды(Структура);    
	СозданиеЗаявкиРасходованиеДС(Структура);   
	Если Структура.Свойство("МассивСоздаваемыхДокументов") Тогда
		МассивНовыхДокументов =  Структура.МассивСоздаваемыхДокументов;
		АдресМассиваНовыхДокументов = ПоместитьВоВременноеХранилище(МассивНовыхДокументов, Новый УникальныйИдентификатор);
	    Структура.Вставить("АдресаНовыхДокументов",АдресМассиваНовыхДокументов);
		Структура.Удалить("МассивСоздаваемыхДокументов");      
	КонецЕсли;
	
	
КонецПроцедуры


&НаСервере
Функция ЗаполнитьДанныеФормыТонкийКлиентНаСервере(ДанныеФормыДокумента, НомерОбъекта, АдресМассиваНовыхДокументов)
	МассивНовыхДокументов = ПолучитьИзВременногоХранилища(АдресМассиваНовыхДокументов);
	НовыйДокументОбъект = МассивНовыхДокументов[НомерОбъекта]; 
	ЗначениеВДанныеФормы(НовыйДокументОбъект,ДанныеФормыДокумента);
КонецФункции

&НаСервере
Функция ПолучитьКоличествоНовыхДокументов(АдресМассиваНовыхДокументов)
    
    МассивНовыхДокументов = ПолучитьИзВременногоХранилища(АдресМассиваНовыхДокументов);
    
    Возврат МассивНовыхДокументов.Количество();
    
КонецФункции

&НаКлиенте
Процедура ВыполнитьСформирование(Команда)  
	Структура = Новый Структура;
	ВыполнитьСформированиеНаСервере(Структура);
	Если Структура.Свойство("АдресаНовыхДокументов") Тогда
		
		АдресМассиваНовыхДокументов = Структура.АдресаНовыхДокументов;
		
		КоличествоНовыхДокументов = ПолучитьКоличествоНовыхДокументов(АдресМассиваНовыхДокументов);
		Для НомерОбъекта = 0 По КоличествоНовыхДокументов - 1 Цикл
			
			ФормаДокумента = ПолучитьФорму("Документ.ЗаявкаНаРасходованиеДенежныхСредств.ФормаОбъекта",,,Истина);
			ДанныеФормыДокумента = ФормаДокумента.Объект;
			ЗаполнитьДанныеФормыТонкийКлиентНаСервере(ДанныеФормыДокумента, НомерОбъекта, АдресМассиваНовыхДокументов);
			КопироватьДанныеФормы(ДанныеФормыДокумента, ФормаДокумента.Объект); 
			ФормаДокумента.Открыть();
			
		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры
