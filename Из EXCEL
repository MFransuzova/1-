
Процедура Инициализировать(Объект, ИмяТабличнойЧасти, ТабличноеПолеОбъекта) Экспорт
		
	
	Если ТабличноеПолеОбъекта.Значение.количество()>0 тогда	
		Если Вопрос("Загрузка из Excel файла очистит таблицу, продолжить?",РежимДиалогаВопрос.ДаНет)=КодВозвратаДиалога.Нет Тогда Возврат; КонецЕсли;
	КонецЕсли;
	
	ТабличноеПолеОбъекта.Значение.Очистить();
	Отказ = ложь;                         
	ВыбратьИЗагрузитьФайл(Отказ);	
	Если Отказ Тогда Возврат; КонецЕсли;
	
	
	формаСПС = ПолучитьФорму("Форма"); 
	формаСПС.ОткрытьМодально();	 
	
	Таб = ТабличноеПолеОбъекта.Значение;
	пРуб = глЗначениеПеременной("ВалютаРегламентированногоУчета");
	пчек = 0;
	Для каждого Стр из ПромежуточнаяТаблицаЗначений Цикл
		//Сообщить("Начало перебора" + Строка(пчек));
		Н= Таб.Добавить(); 
		пчек = пчек + 1;
	КонецЦикла;	
	
	
КонецПроцедуры
	
Процедура ВыбратьИЗагрузитьФайл(Отказ)Экспорт	
	ДиалогЗаписиФайла1 = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);
	ДиалогЗаписиФайла1.Заголовок = "Выбор файла";
	ДиалогЗаписиФайла1.Фильтр = "Файлы Excel (*.xls,*.xlsx)|*.xls;*.xlsx|";
	Если ДиалогЗаписиФайла1.Выбрать() Тогда
		ПолноеИмяФайла = ДиалогЗаписиФайла1.ПолноеИмяФайла;
	иначе
		Отказ = истина;
		Возврат;
	
	КонецЕсли;
	Если НЕ ЗначениеЗаполнено(ПолноеИмяФайла) тогда возврат; КонецЕсли;
	
	ЗагрузкаВТабличныйДокументНаСервереv2(ПолноеИмяФайла);
	
КонецПроцедуры 
	
      
//________________________________________________________________________

Процедура ЗагрузкаВТабличныйДокументНаСервереv2(ИмяФайла)
	ТабДок = Новый ТабличныйДокумент;
	ТабДок.Прочитать(ИмяФайла);
	
	ОбластиТаб = ТабДок.Область(1, 1, ТабДок.ВысотаТаблицы, ТабДок.ШиринаТаблицы);
	
	Построитель = Новый ПостроительЗапроса;
	Построитель.ИсточникДанных = Новый ОписаниеИсточникаДанных(ОбластиТаб);  
	Построитель.Выполнить();
	
	ТабДанные = Построитель.Результат.Выгрузить();   
	Для каждого колонка из  ТабДанные.Колонки Цикл
		//Сообщить(колонка.Имя);
	КонецЦикла;
	//ПечатьТЗ1(ТабДанные);
	
	//Объект.Таблица1.Загрузить(ТабДанные);
	ПромежуточнаяТаблицаЗначений.Очистить();	
	Для Каждого Стр Из ТабДанные Цикл
		Если НЕ ЗначениеЗаполнено(стр[1]) Тогда
			Прервать;
		КонецЕсли;
		
		нс = ПромежуточнаяТаблицаЗначений.Добавить();  
		СтруктураДанных = Новый Структура;
	    СтруктураДанных.Вставить("Код",стр[0]);	
		СтруктураДанных.Вставить("НоменклатураСтрока",стр[1]);
		СтруктураДанных.Вставить("Количество",стр[2]);
		СтруктураДанных.Вставить("Номенклатура",Справочники.Номенклатура.НайтиПоНаименованию(СокрЛП(стр[1])));
		СтруктураДанных.Вставить("ФлагНайдено",ЗначениеЗаполнено(СтруктураДанных.Номенклатура));
        ЗаполнитьЗначенияСвойств(нс,СтруктураДанных);
	//	Сообщить(стр[0]); // Обрабатываем	
	КонецЦикла;
	
КонецПроцедуры        
//_______________________________________________________________________
Процедура ПечатьТЗ1(ТЗ)
	ТабДок = Новый ТабличныйДокумент;
	Рамка = Новый Линия(ТипЛинииЯчейкиТабличногоДокумента.Сплошная, 1);

	ВсегоКолонок = 0;
	Для Каждого Колонка Из ТЗ.Колонки Цикл
		ВсегоКолонок = ВсегоКолонок+1;
		ТабДок.Область("R1"+"C"+Строка(ВсегоКолонок)).Текст = Строка(Колонка.Имя);
		ТабДок.Область("R1"+"C"+Строка(ВсегоКолонок)).Обвести(,Рамка,,Рамка);
	КонецЦикла;
	
	К = 2;
    КолКолонок = 1;	
	Для каждого стр ИЗ ТЗ Цикл
		КолКолонок = 1;	
		Для Каждого Колонка Из ТЗ.Колонки Цикл
			значениеСтроки = стр[Колонка.Имя];
			ТабДок.Область("R"+Строка(К)+"C"+КолКолонок).Текст = значениеСтроки;
			ТабДок.Область("R"+Строка(К)+"C"+КолКолонок).Обвести(,Рамка,,);
			ТабДок.Область("R"+Строка(К)+"C"+КолКолонок).Расшифровка = значениеСтроки;
			ТабДок.Область("R"+Строка(К)+"C"+КолКолонок).ШиринаКолонки = СтрДлина(значениеСтроки);
			КолКолонок=КолКолонок+1;
		КонецЦикла;
		К=К+1;
	КонецЦикла;
	ТабДок.Область("R1"+"C"+КолКолонок+":"+"R"+Строка(К)+"C"+КолКолонок).Обвести(Рамка,Рамка,,);

	ТабДок.ОтображатьСетку = Ложь;
	ТабДок.ТолькоПросмотр = Истина;
	ТабДок.Показать();	
КонецПроцедуры

