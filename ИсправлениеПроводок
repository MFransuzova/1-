Процедура ГАС_РегламентированныйУчет_ПередЗаписьюРегистра(Источник, Отказ, РежимЗаписи) Экспорт
	
	Если Отказ Или Источник.ОбменДанными.Загрузка Или Источник.Количество() = 0 Тогда
		Возврат;
	КонецЕсли;	
	
	мТипИсточника = ТипЗнч(Источник);
	ОбъектМетаданных = Источник.Метаданные();
	ИмяРегистра = ОбъектМетаданных.Имя;
	
	//регистры независимые (без регистратора)
	Если Метаданные.РегистрыСведений.Найти(ИмяРегистра) = ОбъектМетаданных   
		И Метаданные.РегистрыСведений[""+ИмяРегистра].РежимЗаписи = Метаданные.СвойстваОбъектов.РежимЗаписиРегистра.Независимый Тогда 
		Возврат;
	КонецЕсли;
	
	//регистры с регистратором
	мРегистратор = Источник.Отбор.Регистратор.Значение;
	мТип = ТипЗнч(мРегистратор);
	
	
	Если мТипИсточника = Тип("РегистрБухгалтерииНаборЗаписей.Хозрасчетный") Тогда
		#Область РегистрБухгалтерии_Хозрасчетный	
		
		Если мТип = Тип("ДокументСсылка.КорректировкаРеализации")  Тогда    
			// ГАС MF - Заявка HD №000087412 - 09.03.2021 - начало (убрала условие наличия количества ТЧ Товары, так как неверное выведение проводок) 
			// И мРегистратор.Товары.Количество()
			// ГАС MF - Заявка HD №000087412 - 09.03.2021 - окончание
			#Область Документ_КорректировкаРеализации
			//++ ГАС ПетрбаевВИ - Заявка №1/226433 - 28.01.2019 12:17:26 - начало +
			//++ ГАС ПетрбаевВИ - доработано по заявке №1/273608 и №1/273483 - 23.10.2019 +
			Если ЗначениеЗаполнено(мРегистратор.ДокументОснование) И ТипЗнч(мРегистратор.ДокументОснование) = Тип("ДокументСсылка.УСОERP_РеализацияСтроительныхРабот") Тогда 
				Запрос = Новый Запрос;
				Запрос.Текст = "ВЫБРАТЬ
				|	&мРегистратор КАК Регистратор,
				|	ХозрасчетныйДвиженияССубконто.Активность КАК Активность,
				|	ХозрасчетныйДвиженияССубконто.НомерСтроки КАК НомерСтроки,
				|	ХозрасчетныйДвиженияССубконто.СчетДт КАК СчетДт,
				|	ХозрасчетныйДвиженияССубконто.СчетКт КАК СчетКт,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВалютаДт, ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка)) КАК ВалютаДт,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВалютаКт, ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка)) КАК ВалютаКт,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВидСубконтоДт1, ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ПустаяСсылка)) КАК ВидСубконтоДт1,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВидСубконтоДт2, ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ПустаяСсылка)) КАК ВидСубконтоДт2,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВидСубконтоДт3, ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ПустаяСсылка)) КАК ВидСубконтоДт3,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВидСубконтоКт1, ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ПустаяСсылка)) КАК ВидСубконтоКт1,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВидСубконтоКт2, ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ПустаяСсылка)) КАК ВидСубконтоКт2,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВидСубконтоКт3, ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ПустаяСсылка)) КАК ВидСубконтоКт3,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.НаправлениеДеятельностиДт, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельностиДт,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.НаправлениеДеятельностиКт, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельностиКт,
				|	ХозрасчетныйДвиженияССубконто.НеКорректироватьСтоимостьАвтоматически КАК НеКорректироватьСтоимостьАвтоматически,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.Организация, ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)) КАК Организация,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ПодразделениеДт, ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)) КАК ПодразделениеДт,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ПодразделениеКт, ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)) КАК ПодразделениеКт,
				|	ХозрасчетныйДвиженияССубконто.Содержание КАК Содержание,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоДт1, НЕОПРЕДЕЛЕНО) КАК СубконтоДт1,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоДт2, НЕОПРЕДЕЛЕНО) КАК СубконтоДт2,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоДт3, НЕОПРЕДЕЛЕНО) КАК СубконтоДт3,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоКт1, НЕОПРЕДЕЛЕНО) КАК СубконтоКт1,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоКт2, НЕОПРЕДЕЛЕНО) КАК СубконтоКт2,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоКт3, НЕОПРЕДЕЛЕНО) КАК СубконтоКт3
				|ПОМЕСТИТЬ ВТ_ХозрасчетныйДвиженияССубконто
				|ИЗ
				|	РегистрБухгалтерии.Хозрасчетный.ДвиженияССубконто(, , Регистратор = &ДокументОснования, , ) КАК ХозрасчетныйДвиженияССубконто
				|
				|ИНДЕКСИРОВАТЬ ПО
				|	Регистратор
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ ПЕРВЫЕ 1
				|	ХозрасчетныйДвиженияССубконто.Регистратор КАК Регистратор,
				|	ХозрасчетныйДвиженияССубконто.Активность КАК Активность,
				|	ХозрасчетныйДвиженияССубконто.НомерСтроки КАК НомерСтроки,
				|	ХозрасчетныйДвиженияССубконто.СчетДт КАК СчетДт,
				|	ХозрасчетныйДвиженияССубконто.СчетКт КАК СчетКт,
				|	ХозрасчетныйДвиженияССубконто.ВалютаДт КАК ВалютаДт,
				|	ХозрасчетныйДвиженияССубконто.ВалютаКт КАК ВалютаКт,
				|	ХозрасчетныйДвиженияССубконто.ВидСубконтоДт1 КАК ВидСубконтоДт1,
				|	ХозрасчетныйДвиженияССубконто.ВидСубконтоДт2 КАК ВидСубконтоДт2,
				|	ХозрасчетныйДвиженияССубконто.ВидСубконтоДт3 КАК ВидСубконтоДт3,
				|	ХозрасчетныйДвиженияССубконто.ВидСубконтоКт1 КАК ВидСубконтоКт1,
				|	ХозрасчетныйДвиженияССубконто.ВидСубконтоКт2 КАК ВидСубконтоКт2,
				|	ХозрасчетныйДвиженияССубконто.ВидСубконтоКт3 КАК ВидСубконтоКт3,
				|	ХозрасчетныйДвиженияССубконто.НаправлениеДеятельностиДт КАК НаправлениеДеятельностиДт,
				|	ХозрасчетныйДвиженияССубконто.НаправлениеДеятельностиКт КАК НаправлениеДеятельностиКт,
				|	ХозрасчетныйДвиженияССубконто.НеКорректироватьСтоимостьАвтоматически КАК НеКорректироватьСтоимостьАвтоматически,
				|	ХозрасчетныйДвиженияССубконто.Организация КАК Организация,
				|	ХозрасчетныйДвиженияССубконто.ПодразделениеДт КАК ПодразделениеДт,
				|	ХозрасчетныйДвиженияССубконто.ПодразделениеКт КАК ПодразделениеКт,
				|	ХозрасчетныйДвиженияССубконто.Содержание КАК Содержание,
				|	ХозрасчетныйДвиженияССубконто.СубконтоДт1 КАК СубконтоДт1,
				|	ХозрасчетныйДвиженияССубконто.СубконтоДт3 КАК СубконтоДт3,
				|	ХозрасчетныйДвиженияССубконто.СубконтоКт1 КАК СубконтоКт1,
				|	ХозрасчетныйДвиженияССубконто.СубконтоКт2 КАК СубконтоКт2,
				|	ХозрасчетныйДвиженияССубконто.СубконтоКт3 КАК СубконтоКт3
				|ПОМЕСТИТЬ ВТ_РасчетыПоНДСотложенномуДляУплатыВБюджет
				|ИЗ
				|	ВТ_ХозрасчетныйДвиженияССубконто КАК ХозрасчетныйДвиженияССубконто
				|ГДЕ
				|	ХозрасчетныйДвиженияССубконто.СчетДт = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.РасчетыПоНДСотложенномуДляУплатыВБюджет)
				|
				|ИНДЕКСИРОВАТЬ ПО
				|	Регистратор
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	ХозрасчетныйДвиженияССубконто.Регистратор КАК Регистратор,
				|	ХозрасчетныйДвиженияССубконто.Активность КАК Активность,
				|	ХозрасчетныйДвиженияССубконто.НомерСтроки КАК НомерСтроки,
				|	ХозрасчетныйДвиженияССубконто.СчетДт КАК СчетДт,
				|	ХозрасчетныйДвиженияССубконто.СчетКт КАК СчетКт,
				|	ХозрасчетныйДвиженияССубконто.ВалютаДт КАК ВалютаДт,
				|	ХозрасчетныйДвиженияССубконто.ВалютаКт КАК ВалютаКт,
				|	ХозрасчетныйДвиженияССубконто.ВидСубконтоДт1 КАК ВидСубконтоДт1,
				|	ХозрасчетныйДвиженияССубконто.ВидСубконтоДт2 КАК ВидСубконтоДт2,
				|	ХозрасчетныйДвиженияССубконто.ВидСубконтоДт3 КАК ВидСубконтоДт3,
				|	ХозрасчетныйДвиженияССубконто.ВидСубконтоКт1 КАК ВидСубконтоКт1,
				|	ХозрасчетныйДвиженияССубконто.ВидСубконтоКт2 КАК ВидСубконтоКт2,
				|	ХозрасчетныйДвиженияССубконто.ВидСубконтоКт3 КАК ВидСубконтоКт3,
				|	ХозрасчетныйДвиженияССубконто.НаправлениеДеятельностиДт КАК НаправлениеДеятельностиДт,
				|	ХозрасчетныйДвиженияССубконто.НаправлениеДеятельностиКт КАК НаправлениеДеятельностиКт,
				|	ХозрасчетныйДвиженияССубконто.НеКорректироватьСтоимостьАвтоматически КАК НеКорректироватьСтоимостьАвтоматически,
				|	ХозрасчетныйДвиженияССубконто.Организация КАК Организация,
				|	ХозрасчетныйДвиженияССубконто.ПодразделениеДт КАК ПодразделениеДт,
				|	ХозрасчетныйДвиженияССубконто.ПодразделениеКт КАК ПодразделениеКт,
				|	ХозрасчетныйДвиженияССубконто.Содержание КАК Содержание,
				|	ХозрасчетныйДвиженияССубконто.СубконтоДт1 КАК СубконтоДт1,
				|	ХозрасчетныйДвиженияССубконто.СубконтоДт1 КАК СубконтоДт2,
				|	ХозрасчетныйДвиженияССубконто.СубконтоДт3 КАК СубконтоДт3,
				|	ХозрасчетныйДвиженияССубконто.СубконтоКт1 КАК СубконтоКт1,
				|	ХозрасчетныйДвиженияССубконто.СубконтоКт2 КАК СубконтоКт2,
				|	ХозрасчетныйДвиженияССубконто.СубконтоКт3 КАК СубконтоКт3
				|ПОМЕСТИТЬ ВТ_ЗачетАвансовКлиентов
				|ИЗ
				|	ВТ_ХозрасчетныйДвиженияССубконто КАК ХозрасчетныйДвиженияССубконто
				|ГДЕ
				|	ХозрасчетныйДвиженияССубконто.СчетДт = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.РасчетыПоАвансамПолученным)
				|	И ХозрасчетныйДвиженияССубконто.СчетКт = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.РасчетыСПокупателями)
				|
				|ИНДЕКСИРОВАТЬ ПО
				|	Регистратор
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	&мРегистратор КАК Регистратор,
				|	ВЫБОР
				|		КОГДА РасчетыСКлиентамиПоДокументамОстатки.ПредоплатаОстаток > 0
				|			ТОГДА РасчетыСКлиентамиПоДокументамОстатки.ПредоплатаОстаток
				|		ИНАЧЕ -1 * РасчетыСКлиентамиПоДокументамОстатки.ПредоплатаОстаток
				|	КОНЕЦ КАК ПредоплатаОстаток
				|ПОМЕСТИТЬ ВТ_ОстаткиЗачетАвансовКлиентов
				|ИЗ
				|	РегистрНакопления.РасчетыСКлиентамиПоДокументам.Остатки(&Период, ЗаказКлиента = &Договор) КАК РасчетыСКлиентамиПоДокументамОстатки
				|ГДЕ
				|	ЕСТЬNULL(РасчетыСКлиентамиПоДокументамОстатки.ПредоплатаОстаток, 0) <> 0
				|;
				|
				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	КорректировкаРеализации.Ссылка КАК Регистратор,
				|	ХозрасчетныйДвиженияССубконто.Активность КАК Активность,
				|	ХозрасчетныйДвиженияССубконто.НомерСтроки КАК НомерСтроки,
				|	ХозрасчетныйДвиженияССубконто.СчетДт КАК СчетДт,
				|	ХозрасчетныйДвиженияССубконто.СчетКт КАК СчетКт,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВалютаДт, ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка)) КАК ВалютаДт,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВалютаКт, ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка)) КАК ВалютаКт,
				|	0 КАК ВалютнаяСуммаДт,
				|	0 КАК ВалютнаяСуммаКт,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВидСубконтоДт1, ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ПустаяСсылка)) КАК ВидСубконтоДт1,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВидСубконтоДт2, ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ПустаяСсылка)) КАК ВидСубконтоДт2,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВидСубконтоДт3, ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ПустаяСсылка)) КАК ВидСубконтоДт3,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВидСубконтоКт1, ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ПустаяСсылка)) КАК ВидСубконтоКт1,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВидСубконтоКт2, ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ПустаяСсылка)) КАК ВидСубконтоКт2,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВидСубконтоКт3, ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ПустаяСсылка)) КАК ВидСубконтоКт3,
				// ГАС MF - Заявка HD №000087412 - 09.03.2021 - начало  (установила проверку наличия количество ТЧ Товары)
				|	ЕСТЬNULL(0,КорректировкаРеализацииРасхождения.Количество) КАК КоличествоДт,
				|	ЕСТЬNULL(0,КорректировкаРеализацииРасхождения.Количество) КАК КоличествоКт,
				// ГАС MF - Заявка HD №000087412 - 09.03.2021 - окончание
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.НаправлениеДеятельностиДт, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельностиДт,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.НаправлениеДеятельностиКт, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК НаправлениеДеятельностиКт,
				|	ХозрасчетныйДвиженияССубконто.НеКорректироватьСтоимостьАвтоматически КАК НеКорректироватьСтоимостьАвтоматически,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.Организация, ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)) КАК Организация,
				|	КорректировкаРеализации.Дата КАК Период,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ПодразделениеДт, ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)) КАК ПодразделениеДт,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ПодразделениеКт, ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)) КАК ПодразделениеКт,
				|	ХозрасчетныйДвиженияССубконто.Содержание КАК Содержание,
				// ГАС MF - Заявка HD №000087412 - 15.03.2021 - начало  (Заполнение субконто)

				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоДт1, НЕОПРЕДЕЛЕНО) КАК Контрагенты,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоДт1, НЕОПРЕДЕЛЕНО) КАК СубконтоДт1,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоДт2, НЕОПРЕДЕЛЕНО) КАК Договоры,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоДт2, НЕОПРЕДЕЛЕНО) КАК СубконтоДт2,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоДт3, НЕОПРЕДЕЛЕНО) КАК СубконтоДт3,
				|	NULL КАК СФВыданные,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоКт1, НЕОПРЕДЕЛЕНО) КАК СубконтоКт1,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоКт2, НЕОПРЕДЕЛЕНО) КАК СубконтоКт2,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоКт3, НЕОПРЕДЕЛЕНО) КАК НоменклатурныеГруппы,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоКт3, НЕОПРЕДЕЛЕНО) КАК СубконтоКт3,
				|	ВЫБОР
				|		КОГДА ХозрасчетныйДвиженияССубконто.СчетДт = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ВыполненныеЭтапыПоНезавершеннымРаботам)
				|				И ХозрасчетныйДвиженияССубконто.СчетКт = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ВыручкаНеЕНВД)
				|			ТОГДА 0
				|		ИНАЧЕ КорректировкаРеализацииРасхождения.Сумма
				|	КОНЕЦ КАК Сумма,
				|	ВЫБОР
				|		КОГДА ХозрасчетныйДвиженияССубконто.СчетДт = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ВыполненныеЭтапыПоНезавершеннымРаботам)
				|				И ХозрасчетныйДвиженияССубконто.СчетКт = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ВыручкаНеЕНВД)
				|			ТОГДА -1 * (КорректировкаРеализацииРасхождения.Сумма - КорректировкаРеализацииРасхождения.СуммаНДС)
				|		ИНАЧЕ 0
				|	КОНЕЦ КАК СуммаВРДт,
				|	ВЫБОР
				|		КОГДА ХозрасчетныйДвиженияССубконто.СчетДт = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ВыполненныеЭтапыПоНезавершеннымРаботам)
				|				И ХозрасчетныйДвиженияССубконто.СчетКт = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ВыручкаНеЕНВД)
				|			ТОГДА -1 * (КорректировкаРеализацииРасхождения.Сумма - КорректировкаРеализацииРасхождения.СуммаНДС)
				|		ИНАЧЕ 0
				|	КОНЕЦ КАК СуммаВРКт,
				|	ВЫБОР
				|		КОГДА ХозрасчетныйДвиженияССубконто.СчетДт = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.РасчетыСПокупателями)
				|				И ХозрасчетныйДвиженияССубконто.СчетКт = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ВыполненныеЭтапыПоНезавершеннымРаботам)
				|			ТОГДА КорректировкаРеализацииРасхождения.Сумма
				|		КОГДА ХозрасчетныйДвиженияССубконто.СчетДт = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ВыполненныеЭтапыПоНезавершеннымРаботам)
				|				И ХозрасчетныйДвиженияССубконто.СчетКт = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ВыручкаНеЕНВД)
				|			ТОГДА КорректировкаРеализацииРасхождения.Сумма - КорректировкаРеализацииРасхождения.СуммаНДС
				|		ИНАЧЕ 0
				|	КОНЕЦ КАК СуммаНУДт,
				|	ВЫБОР
				|		КОГДА ХозрасчетныйДвиженияССубконто.СчетДт = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ВыполненныеЭтапыПоНезавершеннымРаботам)
				|				И ХозрасчетныйДвиженияССубконто.СчетКт = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ВыручкаНеЕНВД)
				|			ТОГДА КорректировкаРеализацииРасхождения.Сумма - КорректировкаРеализацииРасхождения.СуммаНДС
				|		КОГДА ХозрасчетныйДвиженияССубконто.СчетДт = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.РасчетыСПокупателями)
				|				И ХозрасчетныйДвиженияССубконто.СчетКт = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ВыполненныеЭтапыПоНезавершеннымРаботам)
				|			ТОГДА КорректировкаРеализацииРасхождения.Сумма - КорректировкаРеализацииРасхождения.СуммаНДС
				|		ИНАЧЕ 0
				|	КОНЕЦ КАК СуммаНУКт,
				|	0 КАК СуммаПРДт,
				|	0 КАК СуммаПРКт,
				|	0 КАК СуммаУУ,
				|	0 КАК СуммаФО
				|ИЗ
				|	Документ.КорректировкаРеализации КАК КорректировкаРеализации
				|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.КорректировкаРеализации.Расхождения КАК КорректировкаРеализацииРасхождения
				|		ПО КорректировкаРеализации.Ссылка = КорректировкаРеализацииРасхождения.Ссылка
				|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_ХозрасчетныйДвиженияССубконто КАК ХозрасчетныйДвиженияССубконто
				|		ПО КорректировкаРеализации.Ссылка = ХозрасчетныйДвиженияССубконто.Регистратор
				|ГДЕ
				|	КорректировкаРеализации.Ссылка = &мРегистратор
				|	И НЕ ХозрасчетныйДвиженияССубконто.СчетДт В (ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.РасчетыПоНДСотложенномуДляУплатыВБюджет), ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.РасчетыПоАвансамПолученным))
				|	И НЕ ХозрасчетныйДвиженияССубконто.СчетКт = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.РасчетыСПокупателями)
				|
				|ОБЪЕДИНИТЬ ВСЕ
				|
				|ВЫБРАТЬ
				|	КорректировкаРеализации.Ссылка,
				|	ХозрасчетныйДвиженияССубконто.Активность,
				|	ХозрасчетныйДвиженияССубконто.НомерСтроки,
				|	ХозрасчетныйДвиженияССубконто.СчетДт,
				|	ХозрасчетныйДвиженияССубконто.СчетКт,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВалютаДт, ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка)),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВалютаКт, ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка)),
				|	0,
				|	0,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВидСубконтоДт1, ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ПустаяСсылка)),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВидСубконтоДт2, ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ПустаяСсылка)),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВидСубконтоДт3, ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ПустаяСсылка)),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВидСубконтоКт1, ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ПустаяСсылка)),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВидСубконтоКт2, ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ПустаяСсылка)),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВидСубконтоКт3, ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ПустаяСсылка)),
				|	0,
				|	0,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.НаправлениеДеятельностиДт, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.НаправлениеДеятельностиКт, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
				|	ХозрасчетныйДвиженияССубконто.НеКорректироватьСтоимостьАвтоматически,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.Организация, ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)),
				|	КорректировкаРеализации.Дата,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ПодразделениеДт, ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ПодразделениеКт, ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)),
				|	ХозрасчетныйДвиженияССубконто.Содержание,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоДт1, НЕОПРЕДЕЛЕНО),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоДт1, НЕОПРЕДЕЛЕНО),
				// ГАС MF - Заявка HD №000087412 - 15.03.2021 - начало  (Установка ВидаСубконто Договор)
				|	&Договор,
				// ГАС MF - Заявка HD №000087412 - 15.03.2021 - окончание  (Установка ВидаСубконто Договор)
				|	ЕСТЬNULL(КорректировкаРеализацииГАС_НДС.Документ, НЕОПРЕДЕЛЕНО),
				// ГАС MF - Заявка HD №000087412 - 15.03.2021 - начало  (Установка 3го субконто)
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоДт3, НЕОПРЕДЕЛЕНО),
				|	ЕСТЬNULL(КорректировкаРеализацииГАС_НДС.Документ, НЕОПРЕДЕЛЕНО),
				// ГАС MF - Заявка HD №000087412 - 15.03.2021 - окончание  (Установка 3го субконто)
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоКт1, НЕОПРЕДЕЛЕНО),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоКт2, НЕОПРЕДЕЛЕНО),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоКт3, НЕОПРЕДЕЛЕНО),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоКт3, НЕОПРЕДЕЛЕНО),
				|	КорректировкаРеализацииГАС_НДС.СуммаНДС,
				|	0,
				|	0,
				|	0,
				|	0,
				|	0,
				|	0,
				|	0,
				|	0
				|ИЗ
				|	Документ.КорректировкаРеализации КАК КорректировкаРеализации
				|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_РасчетыПоНДСотложенномуДляУплатыВБюджет КАК ХозрасчетныйДвиженияССубконто
				|		ПО КорректировкаРеализации.Ссылка = ХозрасчетныйДвиженияССубконто.Регистратор
				|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.КорректировкаРеализации.ГАС_НДС КАК КорректировкаРеализацииГАС_НДС
				|		ПО КорректировкаРеализации.Ссылка = КорректировкаРеализацииГАС_НДС.Ссылка
				|ГДЕ
				|	КорректировкаРеализации.Ссылка = &мРегистратор
				|
				|ОБЪЕДИНИТЬ ВСЕ
				|
				|ВЫБРАТЬ
				|	КорректировкаРеализации.Ссылка,
				|	ХозрасчетныйДвиженияССубконто.Активность,
				|	ХозрасчетныйДвиженияССубконто.НомерСтроки,
				|	ХозрасчетныйДвиженияССубконто.СчетДт,
				|	ХозрасчетныйДвиженияССубконто.СчетКт,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВалютаДт, ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка)),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВалютаКт, ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка)),
				|	0,
				|	0,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВидСубконтоДт1, ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ПустаяСсылка)),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВидСубконтоДт2, ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ПустаяСсылка)),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВидСубконтоДт3, ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ПустаяСсылка)),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВидСубконтоКт1, ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ПустаяСсылка)),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВидСубконтоКт2, ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ПустаяСсылка)),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ВидСубконтоКт3, ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ПустаяСсылка)),
				|	0,
				|	0,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.НаправлениеДеятельностиДт, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.НаправлениеДеятельностиКт, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)),
				|	ХозрасчетныйДвиженияССубконто.НеКорректироватьСтоимостьАвтоматически,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.Организация, ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)),
				|	КорректировкаРеализации.Дата,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ПодразделениеДт, ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.ПодразделениеКт, ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)),
				|	ХозрасчетныйДвиженияССубконто.Содержание,
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоДт1, НЕОПРЕДЕЛЕНО),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоДт1, НЕОПРЕДЕЛЕНО),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоДт2, НЕОПРЕДЕЛЕНО),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоДт2, НЕОПРЕДЕЛЕНО),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоДт3, НЕОПРЕДЕЛЕНО),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоДт3, НЕОПРЕДЕЛЕНО),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоКт1, НЕОПРЕДЕЛЕНО),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоКт2, НЕОПРЕДЕЛЕНО),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоКт3, НЕОПРЕДЕЛЕНО),
				|	ЕСТЬNULL(ХозрасчетныйДвиженияССубконто.СубконтоКт3, НЕОПРЕДЕЛЕНО),
				|	ВТ_ОстаткиЗачетАвансовКлиентов.ПредоплатаОстаток,
				|	0,
				|	0,
				|	ВТ_ОстаткиЗачетАвансовКлиентов.ПредоплатаОстаток,
				|	ВТ_ОстаткиЗачетАвансовКлиентов.ПредоплатаОстаток,
				|	0,
				|	0,
				|	0,
				|	0
				// ГАС MF - Заявка HD №000087412 - 15.03.2021 - начало  (Заполнение субконто)
				|ИЗ
				|	Документ.КорректировкаРеализации КАК КорректировкаРеализации
				|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_ЗачетАвансовКлиентов КАК ХозрасчетныйДвиженияССубконто
				|		ПО КорректировкаРеализации.Ссылка = ХозрасчетныйДвиженияССубконто.Регистратор
				|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_ОстаткиЗачетАвансовКлиентов КАК ВТ_ОстаткиЗачетАвансовКлиентов
				|		ПО КорректировкаРеализации.Ссылка = ВТ_ОстаткиЗачетАвансовКлиентов.Регистратор
				|ГДЕ
				|	КорректировкаРеализации.Ссылка = &мРегистратор";
				Запрос.УстановитьПараметр("ДокументОснования", мРегистратор.ДокументОснование);
				Запрос.УстановитьПараметр("мРегистратор", 	   мРегистратор);
				Запрос.УстановитьПараметр("Период", 		   Новый Граница(мРегистратор.Дата, ВидГраницы.Включая));
				Запрос.УстановитьПараметр("Договор", 		   мРегистратор.Договор); 
				// ГАС MF - Заявка HD №000087412 - 09.03.2021 - начало  (рефакторинг кода)
				// ГАС MF - Заявка HD №000087412 - 15.03.2021 - начало  (возврат типовых проводок так как задача требует большего времени для решения)
				ТаблицаЗаписей = Источник.Выгрузить();   //выводилось в попытки исключения  возврат типовых проводок   
				// ГАС MF - Заявка HD №000087412 - 15.03.2021 - начало  (возврат типовых проводок так как задача требует большего времени для решения)
				РезультатЗапроса = Запрос.Выполнить().Выгрузить();
				
				Если НЕ РезультатЗапроса.Количество()=0 Тогда
					ТаблицаЗаписей.Очистить();
					ТаблицаЗаписей.Колонки.Добавить("СубконтоДт",Новый ОписаниеТипов("РегистрБухгалтерииСубконто.Хозрасчетный"));
					ТаблицаЗаписей.Колонки.Добавить("СубконтоКт",Новый ОписаниеТипов("РегистрБухгалтерииСубконто.Хозрасчетный"));
					Для каждого стр_Проводки из РезультатЗапроса Цикл
						нс = ТаблицаЗаписей.Добавить();            
						СК = ОбщегоНазначения.СтрокаТаблицыЗначенийВСтруктуру(стр_Проводки);
						ЗаполнитьЗначенияСвойств(нс,СК);
						ЗаполнитьЗначенияСвойств(нс.СубконтоДт,СК);
						ЗаполнитьЗначенияСвойств(нс.СубконтоКт,СК);
					КонецЦикла;   
				КонецЕсли;
				// ГАС MF - Заявка HD №000087412 - 15.03.2021 - начало  (возврат типовых проводок так как задача требует большего времени для решения)
				Источник.Загрузить(ТаблицаЗаписей);   //выводилось в попытки исключения  возврат типовых проводок   
				// ГАС MF - Заявка HD №000087412 - 15.03.2021 - начало  (возврат типовых проводок так как задача требует большего времени для решения)
				
				// ГАС MF - Заявка HD №000087412 - 09.03.2021 - окончание  (рефакторинг кода)
			КонецЕсли;
