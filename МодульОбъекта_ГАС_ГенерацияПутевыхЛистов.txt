&НаСервере
Процедура СозданиеПЛ_Сервер(Структура) 
	Сообщение = Новый СообщениеПользователю;
    Сообщение.Текст = Структура.ДатаНачала;
	Сообщение.Сообщить();
	

	НовыйПЛ = Структура.ДокументКопирования.Скопировать();                                                                                                                            
	КолДнейВозвращение = Окр(ОбщегоНазначенияУТ.РазностьДат(Структура.ДокументКопирования.ДатаВыезда,Структура.ДокументКопирования.ДатаВозвращения,Перечисления.Периодичность.День),0);
	
	Если Структура.ПериодДаты>0 Тогда
		НовыйПЛ.Дата = КонецДня(Структура.ДатаНачала) + 1;
	Иначе
		НовыйПЛ.Дата = Структура.ДатаНачала;
	КонецЕсли;     
	НовыйПЛ.ДатаВыезда       = уатОбщегоНазначения.уатДатаБезСекунд(НовыйПЛ.Дата);
	НовыйПЛ.ДатаВозвращения	= уатОбщегоНазначения.уатДатаБезСекунд(КонецДня(Структура.ДатаНачала) + КолДнейВозвращение);
	НовыйПЛ.ГАС_ДатаВыезда = НовыйПЛ.ДатаВыезда ;
	Если НовыйПЛ.ДатаВыезда > НовыйПЛ.ДатаВозвращения Тогда
		НовыйПЛ.ДатаВозвращения = НовыйПЛ.ДатаВыезда;
	КонецЕсли;
	НовыйПЛ.ГАС_ДатаВозвращения = НовыйПЛ.ДатаВозвращения;	
	НовыйПЛ.ДатаЗакрытия = ?(НовыйПЛ.ГАС_ДатаВозвращения > НовыйПЛ.ГАС_ДатаВыезда, НовыйПЛ.ГАС_ДатаВозвращения - 1, НовыйПЛ.ГАС_ДатаВозвращения);
	
	НовыйПЛ.ДействителенДо = ?(ЗначениеЗаполнено(НовыйПЛ.ГАС_ДатаВозвращения), КонецДня(НовыйПЛ.ГАС_ДатаВозвращения), НовыйПЛ.ГАС_ДатаВозвращения);
	
	НовыйПЛ.Записать();
	
	Структура.Вставить("ДатаНачала",НовыйПЛ.Дата);
	Структура.МассивДокументов.Добавить(НовыйПЛ);

КонецПроцедуры

&НаСервере
Процедура СоздатьКопииДокументовМодуль(Структура) Экспорт
	Сообщение = Новый СообщениеПользователю;
	Если НЕ Структура.Свойство("ДокументыКопирования") Тогда
		Возврат;
	КонецЕсли;
	//Сообщение.Текст = Строка();
	//Сообщение.Сообщить();
	МассивДокументов = Новый Массив;
	КолДней = ОбщегоНазначенияУТ.РазностьДат(ЭтотОбъект.ПериодДокументов.ДатаНачала,ЭтотОбъект.ПериодДокументов.ДатаОкончания,Перечисления.Периодичность.День);
	Структура.Вставить("ДатаНачала",ЭтотОбъект.ПериодДокументов.ДатаНачала);
	Структура.Вставить("МассивДокументов",МассивДокументов);
	Для каждого шаблон из Структура.ДокументыКопирования Цикл	
		Структура.Вставить("ДокументКопирования",шаблон.ДокументКопирования.ПолучитьОбъект());

		Если НЕ КолДней > 1 Тогда
			КолДней = 0;
		КонецЕсли;    
		Для к = 0 ПО КолДней-1 Цикл
			Структура.Вставить("ПериодДаты",к);
			СозданиеПЛ_Сервер(Структура);
		КонецЦикла;
	КонецЦикла;
	Если НЕ Структура.МассивДокументов.Количество()=0 Тогда
		Структура.Вставить("ДокументыНовые",Структура.МассивДокументов);
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьДокументыКопированияМодуль(Структура) Экспорт
	Сообщение = Новый СообщениеПользователю;
	//Сообщение.Текст = "Здесь";
	//Сообщение.Сообщить();
	Запрос = Новый Запрос;
	Запрос.Текст = "
	|ВЫБРАТЬ
	|Док.Ссылка КАК ДокументКопирования
	|ИЗ Документ.уатПутевойЛист КАК Док
	|ГДЕ Док.Ссылка.Дата МЕЖДУ НАЧАЛОПЕРИОДА(&ДН,ДЕНЬ) И КОНЕЦПЕРИОДА(&ДК,ДЕНЬ)
	|И Док.Ссылка.Проведен
	|";
	Запрос.УстановитьПараметр("ДН",ЭтотОбъект.ПериодДокументов.ДатаНачала);
	Запрос.УстановитьПараметр("ДК",ЭтотОбъект.ПериодДокументов.ДатаОкончания);
	Результат = Запрос.Выполнить().Выгрузить();
	МассивДокументов = ОбщегоНазначения.ТаблицаЗначенийВМассив(Результат);
	
	Если НЕ МассивДокументов.Количество()=0 Тогда
		Структура.Вставить("ДокументыКопирования",МассивДокументов);
	КонецЕсли;
	
КонецПроцедуры


