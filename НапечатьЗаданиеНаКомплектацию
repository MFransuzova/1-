Процедура НапечатьЗаданиеНаКомплектацию(ТД)
    Результат = ВернутьРезультатЗапросаЗаказы();	
	//Макет = ПолучитьМакет("МаршрутныйЛист");
	Макет = УправлениеПечатью.МакетПечатнойФормы("Обработка.DA_КомплектацияЗаказов.ЗаданиеНаКомплектацию");
	
	МассивЯчеек = Результат.ВыгрузитьКолонку("Контейнер");
	МассивЯчеек = Вспомогательные.СвернутьМассив(МассивЯчеек);
	//Для каждого элЯ из МассивЯчеек Цикл
	//	Если НЕ ЗначениеЗаполнено(элЯ) Тогда
	//		Продолжить;
	//	КонецЕсли;	
		СтруктураПараметовПечати = Новый Структура;
		
		
		СтруктураПараметовПечати.Вставить("Заголовок","Задание на копмплектацию от "+Формат(Объект.ДатаОтгрузки,"ДЛФ=Д" ));
		СтруктураПараметовПечати.Вставить("контейнер",Неопределено);
		СтруктураПараметовПечати.Вставить("НомерЗаказа",Неопределено);
		СтруктураПараметовПечати.Вставить("Клиент",Неопределено);
		СтруктураПараметовПечати.Вставить("ЗаголовокЗаказа",Неопределено);
		
		ОбластьШапка         = Макет.ПолучитьОбласть("Шапка");
		ОбластьЗаказы        = Макет.ПолучитьОбласть("Заказы");
		ОбластьПолосаЗаказов = Макет.ПолучитьОбласть("ПолосаЗаказов");
		ОбластьШапкаЗаказа   = Макет.ПолучитьОбласть("ШапкаЗаказа");
		ОбластьСтрокаЗаказа  = Макет.ПолучитьОбласть("СтрокаЗаказа");
		ОбластьПолосаЗаказа  = Макет.ПолучитьОбласть("ПолосаЗаказа");
		
		
		ЗаполнитьЗначенияСвойств(ОбластьШапка.Параметры,СтруктураПараметовПечати);
		ТД.Вывести(ОбластьШапка);
		МассивЗаказов = Результат.ВыгрузитьКолонку("Заказ");
		МассивЗаказов = Вспомогательные.СвернутьМассив(МассивЗаказов);
			
		
		Для каждого эл из МассивЗаказов Цикл
			СтруктураПараметовПечати.Вставить("НомерЗаказа",эл.Номер);
			СтруктураПараметовПечати.Вставить("Клиент",Неопределено);
			ЗаполнитьЗначенияСвойств(ОбластьЗаказы.Параметры,СтруктураПараметовПечати);
			ТД.Вывести(ОбластьЗаказы);
		КонецЦикла;
		
		этоПервый = Истина;
		колСтрок =  ТД.ВысотаТаблицы;
		Для каждого эл из МассивЗаказов Цикл
			//Если НЕ этоПервый Тогда
			//	колСтрок = 0;
			//КонецЕсли;
			
	
			Отбор = Новый Структура;
			Отбор.Вставить("Заказ",эл);
			//Отбор.Вставить("Контейнер",элЯ);
			ТЗ = Результат.НайтиСтроки(Отбор);    
			Если ТипЗнч(эл) = Тип("ДокументСсылка.ЗаказКлиента") Тогда
				СтруктураПараметовПечати.Вставить("ЗаголовокЗаказа","№ "+эл.Номер+" "+СокрЛП(эл.Контрагент));  
				СтруктураПараметовПечати.Вставить("Склад",эл.Склад);
			Иначе
				СтруктураПараметовПечати.Вставить("ЗаголовокЗаказа","№ "+эл.Номер+" "+СокрЛП(эл.СкладПолучатель));
				СтруктураПараметовПечати.Вставить("Склад",эл.СкладОтправитель);
			КонецЕсли;
			СтруктураПараметовПечати.Вставить("Комментарий",СокрЛП(эл.Комментарий));
			ЗаполнитьЗначенияСвойств(ОбластьШапкаЗаказа.Параметры,СтруктураПараметовПечати); 
			колСтрок = колСтрок + 6;  
			//Сообщить(Строка(колСтрок));
			Если колСтрок > 43 Тогда
				ТД.ВывестиГоризонтальныйРазделительСтраниц();
			КонецЕсли;
			ТД.Вывести(ОбластьШапкаЗаказа);  
			
			нп = 1;
			//ТЗ = Вспомогательные.МассивВТаблицуЗначений(Найдены);
			//ТЗ.Свернуть("Номенклатура,Упаковка,Ячейка","Количество");
			ТекНоменклатура = Неопределено;
			НужноеКоличество = 0;
 
			Для каждого стрТЗ ИЗ ТЗ Цикл  
				Если стрТЗ.Номенклатура.ТипНоменклатуры = ПредопределенноеЗначение("Перечисление.ТипыНоменклатуры.Услуга") Тогда
					Продолжить;
				КонецЕсли;	
				Если НЕ ТекНоменклатура = стрТЗ.Номенклатура Тогда
					ТекНоменклатура = Неопределено;
					НужноеКоличество = 0;
				КонецЕсли;

				//Если  ТД.ВысотаТаблицы = 30 ИЛИ ТД.ВысотаТаблицы = 50 Тогда
				//	ТД.ВывестиГоризонтальныйРазделительСтраниц();
				//КонецЕсли;
				//
				//Если ТД.ВысотаТаблицы = ТД.ВысотаСтраницы-3 Тогда
				//	ТД.ВывестиГоризонтальныйРазделительСтраниц();
				//КонецЕсли;
				СК = ОбщегоНазначения.СтрокаТаблицыЗначенийВСтруктуру(стрТЗ);
				СтруктураПараметовПечати.Вставить("нп",нп);        
				СтруктураПараметовПечати.Вставить("Ячейка",Неопределено);
				СтруктураПараметовПечати.Вставить("Развес",Ложь);
				СтруктураПараметовПечати.Вставить("колqr",0);
				Для каждого скл из СК Цикл
					СтруктураПараметовПечати.Вставить(скл.Ключ,скл.Значение);
				КонецЦикла;
				СтруктураПараметовПечати.Вставить("Упаковка",стрТЗ.Номенклатура.ЕдиницаИзмерения);
				DA_ДанныеНоменклатуры.НоменклатураКоличествоШТ(СтруктураПараметовПечати);
				Если НЕ ЗначениеЗаполнено(СтруктураПараметовПечати.Остаток) Тогда
					СтруктураПараметовПечати.Вставить("Остаток",СтруктураПараметовПечати.Количество);
				КонецЕсли;	
				Если СтруктураПараметовПечати.колqr = 0 Тогда
					Если НужноеКоличество  < СтруктураПараметовПечати.Количество Тогда
						Если  СтруктураПараметовПечати.Количество> СтруктураПараметовПечати.Остаток Тогда  
							разница = СтруктураПараметовПечати.Количество>НужноеКоличество ;
							Если разница>0 И разница < СтруктураПараметовПечати.Остаток Тогда
								колqr =   разница;
							Иначе
								колqr =  СтруктураПараметовПечати.Остаток;
							КонецЕсли;
						Иначе
							колqr  = СтруктураПараметовПечати.Количество;
						КонецЕсли;	
					КонецЕсли;
					СтруктураПараметовПечати.Вставить("колqr",колqr);
				КонецЕсли;	
				СтруктураПараметовПечати.Вставить("колqr",Окр(СтруктураПараметовПечати.колqr,0,1));
				
				СтруктураПараметовПечати.Вставить("Развес",?(СтруктураПараметовПечати.Развес,"V",""));
				
				ЗаполнитьЗначенияСвойств(ОбластьСтрокаЗаказа.Параметры,СтруктураПараметовПечати);
				ТД.Вывести(ОбластьСтрокаЗаказа);
				нп = нп+1;  
				ТекНоменклатура = стрТЗ.Номенклатура;
				НужноеКоличество =  НужноеКоличество + СтруктураПараметовПечати.колqr;
				колСтрок = колСтрок + 1;
			КонецЦикла; 
			ТД.Вывести(ОбластьПолосаЗаказа); 
			колСтрок = колСтрок+1;
			разница = 50 - колСтрок;
			
			Если разница<16 И разница>0 Тогда
				ТД.ВывестиГоризонтальныйРазделительСтраниц();
				колСтрок = 0;
		    ИначеЕсли разница<0 Тогда	
				колСтрок = -разница;
			КонецЕсли;
			
			этоПервый = Ложь;
			  
			колСтрок = колСтрок + 6;
			//КонецЦикла;
		//ТД.ВывестиГоризонтальныйРазделительСтраниц();
	КонецЦикла;	
	ТД.ОриентацияСтраницы = ОриентацияСтраницы.Портрет;
	
КонецПроцедуры
