// + WA MF 28.10.2021 https://jira.9958258.ru/browse/DNS-93     

&НаСервере
Процедура ВыгрузитьШаблонЗагрузкиНаСервере(СтруктураЗаписи) 
	СтруктураШаблона = Новый Структура;
	СтруктураШаблона.Вставить("Заявка","Заявка");
	СтруктураШаблона.Вставить("СтоимостьДоставки","Стоимость доставки");    
	СтруктураШаблона.Вставить("Возврат","Возврат");
	СтруктураШаблона.Вставить("СтоимостьВозврата","Стоимость возврата");   
	Результат = Новый ТаблицаЗначений;
	Для каждого ст из СтруктураШаблона Цикл  
		Результат.Колонки.Добавить(ст.Ключ,,ст.Значение);
	КонецЦикла;
	//______ пустой шаблон __________
	строкиШаблона = 1;
	Пока строкиШаблона<4 Цикл  
		нс = Результат.Добавить();
		строкиШаблона = строкиШаблона+1;
	КонецЦикла;  
	Шапка = "Шаблон для перевозчика последней мили";  
	Подвал = "";
	//ПечатьТЗ1(ТЗ,Шапка,Подвал);
	ТабДок.Очистить();
	
	Построитель=Новый ПостроительОтчета;
	Построитель.ВыводитьЗаголовокОтчета = Ложь;
	Построитель.ИсточникДанных=Новый ОписаниеИсточникаДанных(Результат);
	Построитель.ЗаполнениеРасшифровки = ВидЗаполненияРасшифровкиПостроителяОтчета.Расшифровка;    
	Построитель.Вывести(ТабДок);        
	
	Область = ТабДок.Область("R1C1:R100C1") ;
	Сдвиг =  ТипСмещенияТабличногоДокумента.ПоГоризонтали ;  
	//WA_MF_Вспомогательные.ВернутьТипФайла(СтруктураЗаписи);
	НачалоТипа = СтрНайти(СтруктураЗаписи.ПутьКФайлу,".",НаправлениеПоиска.СКонца);
	Если  НачалоТипа >0 Тогда
		СтруктураЗаписи.Вставить("ТипФайла",Сред(СтруктураЗаписи.ПутьКФайлу,НачалоТипа+1,СтрДлина(СтруктураЗаписи.ПутьКФайлу)));
	КонецЕсли;  
	ТипФайла = СтруктураЗаписи.ТипФайла;
	Если СтруктураЗаписи.ТипФайла = "xls" Тогда	
		ТабДок.УдалитьОбласть(Область,Сдвиг);
		Для к = 1 ПО 35 Цикл
			Область = ТабДок.Область("R1C"+к+":R1C"+к+"") ;
			Если Область.СодержитЗначение Тогда
				Область.Значение = СокрЛП(Область.Значение)+";";
			Иначе
				Область.Текст = СокрЛП(Область.Текст)+";";
			КонецЕсли;
		КонецЦикла;    
		ТипФайла = "TXT";
	Иначе
		
	КонецЕсли;
	//ТипФайла = ;
	//АдресХранилища = ПоместитьТабличныйДокументВоВременноеХранилищеНаСервере(ТабДок, "xlsx", ТипФайлаТабличногоДокумента.XLSX);
	//
	//Если АдресХранилища = Неопределено Тогда
	//	ПоказатьПредупреждение( , НСтр("ru = 'Что-то пошло не так :('"));
	//	Возврат;
	//КонецЕсли;
	ТабДок.Записать(СтруктураЗаписи.ПутьКФайлу,ПредопределенноеЗначение("ТипФайлаТабличногоДокумента."+Строка(ТипФайла)));
	
КонецПроцедуры     
// - WA MF 28.10.2021 https://jira.9958258.ru/browse/DNS-93

// + WA MF 28.10.2021 https://jira.9958258.ru/browse/DNS-93
&НаКлиенте
Процедура ВыгрузитьШаблонЗагрузки(Команда)
	//АдресФайлаДанныхВХранилище = ВыполнитьВыгрузкуНаСервере();
	//Если АдресФайлаДанныхВХранилище = Неопределено Тогда
	//	Возврат;
	//КонецЕсли;
	//
	//ИмяСохраняемогоФайла = НСтр("ru = 'Файл выгрузки.xml'");
	//
	//ПолучитьФайл(АдресФайлаДанныхВХранилище, ИмяСохраняемогоФайла);
	Режим = РежимДиалогаВыбораФайла.Сохранение; 
	ДиалогСохраненияФайла = Новый ДиалогВыбораФайла(Режим); 
	ДиалогСохраненияФайла.ПолноеИмяФайла = "Шаблон_для_перевозчика_ПоследнейМили"+Формат(ТекущаяДата(),"ДФ=M_yy"); 
	Фильтр = "(Файл Microsoft Office Excel (*.xls)|*.xls| Файл Microsoft Office Excel (*.xlsx)|*.xlsx| Файл Microsoft Office (*.doc)|*.doc|Файл Microsoft Office (*.docx)|*.docx| Файлы профиля ключевых операций (*.xml)|*.xml";                 
	ДиалогСохраненияФайла.Фильтр = Фильтр; 
	ДиалогСохраненияФайла.МножественныйВыбор = Ложь; 
	ДиалогСохраненияФайла.Заголовок = "Выберите файл"; 
	СтруктураЗаписи = Новый Структура;
	Если ДиалогСохраненияФайла.Выбрать() Тогда 
		СтруктураЗаписи.Вставить("ПутьКФайлу",ДиалогСохраненияФайла.ПолноеИмяФайла); 
		ВыгрузитьШаблонЗагрузкиНаСервере(СтруктураЗаписи);
	КонецЕсли;  
КонецПроцедуры  
// - WA MF 28.10.2021 https://jira.9958258.ru/browse/DNS-93


