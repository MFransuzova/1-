


Функция СведенияОВнешнейОбработке() Экспорт
	
	ВерсияБСП = "3.0.1.0";
	
	ПараметрыРегистрации = ДополнительныеОтчетыИОбработки.СведенияОВнешнейОбработке(ВерсияБСП);
	ПараметрыРегистрации.Информация = НСтр("ru = 'Новация (Word)'");
	ПараметрыРегистрации.Вид = ДополнительныеОтчетыИОбработкиКлиентСервер.ВидОбработкиПечатнаяФорма();
	ПараметрыРегистрации.Версия = "1.0.0.0";
	ПараметрыРегистрации.Назначение.Добавить("Документ.КорректировкаДолга");
	
	Команда = ПараметрыРегистрации.Команды.Добавить();
	Команда.Представление = НСтр("ru = 'Новация (Word)'");
	Команда.Идентификатор = "ПечатьНовацияWord";
	Команда.Использование = ДополнительныеОтчетыИОбработкиКлиентСервер.ТипКомандыВызовСерверногоМетода();
	
	Возврат ПараметрыРегистрации;
	
КонецФункции
// ~! Начало  Французова 19.08.2024   (AUC-1985)


Процедура Печать(МассивОбъектов, КоллекцияПечатныхФорм, ОбъектыПечати, ПараметрыВывода) Экспорт
	
	ПечатнаяФорма = УправлениеПечатью.СведенияОПечатнойФорме(КоллекцияПечатныхФорм, "ПечатьНовацияWord");
	Если ПечатнаяФорма <> Неопределено Тогда		
		ОфисныеДокументы = НапечататьНовацию(МассивОбъектов);
		ПечатнаяФорма.СинонимМакета = НСтр("ru = 'Печать Новация (Word)'");
		ПечатнаяФорма.ОфисныеДокументы = ОфисныеДокументы;
	КонецЕсли;
	
КонецПроцедуры    
// ~! Конец Французова 19.08.2024   (AUC-1985)
// ~! Начало  Французова 19.08.2024   (AUC-1985)

Функция НапечататьНовацию(МассивОбъектов)
	УстановитьПривилегированныйРежим(Истина);
	ОфисныеДокументы = Новый Соответствие;
	МакетДокумента = ПолучитьМакет("Новация");
	Шаблон = НСтр("ru = 'Корректировка долга №[Номер] от [Дата]'");
	
	Макет = УправлениеПечатью.ИнициализироватьМакетОфисногоДокумента(МакетДокумента, Неопределено,);
	Если Макет = Неопределено Тогда
		Возврат "";
	КонецЕсли;
	
	ОписаниеОбластей = Новый Структура;            
	УправлениеПечатью.ДобавитьОписаниеОбласти(ОписаниеОбластей, "ВерхнийКолонтитул",       "ВерхнийКолонтитул");
	УправлениеПечатью.ДобавитьОписаниеОбласти(ОписаниеОбластей, "ВерхнийЧетныйКолонтитул", "ВерхнийЧетныйКолонтитул");
	УправлениеПечатью.ДобавитьОписаниеОбласти(ОписаниеОбластей, "Шапка",         		   "Общая");   
	УправлениеПечатью.ДобавитьОписаниеОбласти(ОписаниеОбластей, "Договоры",                "Общая");
	УправлениеПечатью.ДобавитьОписаниеОбласти(ОписаниеОбластей, "ДоговорыСведения",        "Общая");
	УправлениеПечатью.ДобавитьОписаниеОбласти(ОписаниеОбластей, "ДоговорыСведенияДетали",  "Общая");
	УправлениеПечатью.ДобавитьОписаниеОбласти(ОписаниеОбластей, "Подвал",         		   "Общая");
	УправлениеПечатью.ДобавитьОписаниеОбласти(ОписаниеОбластей, "НижнийКолонтитул",        "НижнийКолонтитул");
	УправлениеПечатью.ДобавитьОписаниеОбласти(ОписаниеОбластей, "НижнийЧетныйКолонтитул",  "НижнийЧетныйКолонтитул");
	
	ДанныеПоШапке = ПолучитьДанныеДляПечати(МассивОбъектов);
	
	Для Каждого ДанныеПечати Из ДанныеПоШапке Цикл
		
		ДанныеПечати.Дата = Формат(ДанныеПечати.Дата, "ДЛФ=DD");
		
		ПечатнаяФорма = УправлениеПечатью.ИнициализироватьПечатнуюФорму(Неопределено, Неопределено, Макет);
		АдресХранилищаПечатнойФормы= "";
		Если ПечатнаяФорма = Неопределено Тогда
			УправлениеПечатью.ОчиститьСсылки(Макет);
			Возврат ОфисныеДокументы;
		КонецЕсли;
		
		
		// Вывод верхних колонтитулов
		Область = УправлениеПечатью.ОбластьМакета(Макет, ОписаниеОбластей["ВерхнийКолонтитул"]);
		УправлениеПечатью.ПрисоединитьОбластьИЗаполнитьПараметры(ПечатнаяФорма, Область, ДанныеПечати);
		
		// Для четных страниц свои колонтитулы
		Область = УправлениеПечатью.ОбластьМакета(Макет, ОписаниеОбластей["ВерхнийЧетныйКолонтитул"]);
		УправлениеПечатью.ПрисоединитьОбластьИЗаполнитьПараметры(ПечатнаяФорма, Область, ДанныеПечати);
		
		// Вывод верхней части документа - обычная область с параметрами.
		Область = УправлениеПечатью.ОбластьМакета(Макет, ОписаниеОбластей["Шапка"]);
		УправлениеПечатью.ПрисоединитьОбластьИЗаполнитьПараметры(ПечатнаяФорма, Область, ДанныеПечати);
		
		//// Вывод коллекции данных из информационной базы в виде таблицы.
		//Область = УправлениеПечатью.ОбластьМакета(Макет, ОписаниеОбластей["Договоры"]);
		//УправлениеПечатью.ПрисоединитьОбласть(ПечатнаяФорма, Область, Ложь);
		
		// Вывод коллекции данных из информационной базы в виде таблицы.     
		Для к=1 ПО 3 Цикл
			ПараметрыДоговоры = Новый Структура;
			ПараметрыДоговоры.Вставить("ПунктДоговор",Строка("1.1."+Строка(к)));		
			Область = УправлениеПечатью.ОбластьМакета(Макет, ОписаниеОбластей["Договоры"]);
			УправлениеПечатью.ПрисоединитьОбластьИЗаполнитьПараметры(ПечатнаяФорма, Область, ПараметрыДоговоры);
		КонецЦикла;   
		
		
				// Вывод верхней части документа - обычная область с параметрами.
		Область = УправлениеПечатью.ОбластьМакета(Макет, ОписаниеОбластей["ДоговорыСведения"]);
		УправлениеПечатью.ПрисоединитьОбласть(ПечатнаяФорма, Область, Ложь);
        Для к=1 ПО 3 Цикл
			ПараметрыДоговоры = Новый Структура;
			ПараметрыДоговоры.Вставить("ПунктДоговор",Строка("1.2."+Строка(к)));		
			Область = УправлениеПечатью.ОбластьМакета(Макет, ОписаниеОбластей["ДоговорыСведенияДетали"]);
			УправлениеПечатью.ПрисоединитьОбластьИЗаполнитьПараметры(ПечатнаяФорма, Область, ПараметрыДоговоры);
		КонецЦикла;
		// Вывод строка ТЧ   
		//Область = УправлениеПечатью.ОбластьМакета(Макет, ОписаниеОбластей["Договоры"]);
		//УправлениеПечатью.ПрисоединитьОбластьИЗаполнитьПараметры(ПечатнаяФорма, Область, ДанныеПечати);
		
		////Если  ДанныеПечати.Свойство("Договоры") Тогда   
		////	Для каждого эл из ДанныеПечати.Договоры Цикл
		//		ДанныеПечатиДоговоры = Новый Массив;//ОбщегоНазначения.ТаблицаЗначенийВМассив(ДанныеПечати.Договоры.Выгрузить());  
		//		ДанныеПечатиДоговоры.Добавить("1.1");    
		//		ДанныеПечатиДоговоры.Добавить("1.2");
		//		ДанныеПечатиДоговоры.Добавить("1.3");
		//		Область = УправлениеПечатью.ОбластьМакета(Макет, ОписаниеОбластей["СтрокаТаблицы"]);
		//		УправлениеПечатью.ПрисоединитьИЗаполнитьКоллекцию(ПечатнаяФорма, Область, ДанныеПечатиДоговоры);
		////	КонецЦикла;
		////КонецЕсли;
		
		// Вывод подвала документа
		Область = УправлениеПечатью.ОбластьМакета(Макет, ОписаниеОбластей["Подвал"]);
		УправлениеПечатью.ПрисоединитьОбластьИЗаполнитьПараметры(ПечатнаяФорма, Область, ДанныеПечати);
		
		// Вывод нижних колонтитулов
		Область = УправлениеПечатью.ОбластьМакета(Макет, ОписаниеОбластей["НижнийКолонтитул"]);
		УправлениеПечатью.ПрисоединитьОбластьИЗаполнитьПараметры(ПечатнаяФорма, Область, ДанныеПечати);
		
		// Для четных страниц свои колонтитулы
		Область = УправлениеПечатью.ОбластьМакета(Макет, ОписаниеОбластей["НижнийЧетныйКолонтитул"]);
		УправлениеПечатью.ПрисоединитьОбластьИЗаполнитьПараметры(ПечатнаяФорма, Область, ДанныеПечати);
		
		АдресХранилищаПечатнойФормы = УправлениеПечатью.СформироватьДокумент(ПечатнаяФорма); 
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = Строка(АдресХранилищаПечатнойФормы);
		Сообщение.Сообщить();
		
		УправлениеПечатью.ОчиститьСсылки(ПечатнаяФорма);
		
		ЗначенияРеквизитовДокумента = Новый Структура("Организация,Номер,Дата,Ссылка");
		ЗаполнитьЗначенияСвойств(ЗначенияРеквизитовДокумента, ДанныеПечати);
		ЗначенияРеквизитовДокумента.Дата = Формат(ЗначенияРеквизитовДокумента.Дата, "ДЛФ=D");
		ЗначенияРеквизитовДокумента.Номер = ПрефиксацияОбъектовКлиентСервер.НомерНаПечать(ЗначенияРеквизитовДокумента.Номер);
		ИмяДокумента = СтроковыеФункцииКлиентСервер.ВставитьПараметрыВСтроку(Шаблон, ЗначенияРеквизитовДокумента);
		
		ОфисныеДокументы.Вставить(АдресХранилищаПечатнойФормы, ИмяДокумента);
		
	КонецЦикла;
	
	УправлениеПечатью.ОчиститьСсылки(Макет);
	УстановитьПривилегированныйРежим(Ложь);
	Возврат ОфисныеДокументы;
	
КонецФункции 
// ~! Конец Французова 19.08.2024   (AUC-1985)
// ~! Начало  Французова 19.08.2024   (AUC-1985)


Функция ПолучитьДанныеДляПечати(МассивОбъектов)
	//Дата
	//Номер
	//ДатаНомер
	//Организация
	//ОрганизацияПН   
	//ОГРН
	//ИНН
	//КонтрагентДебитор
	//КонтактнаяИнформация 
	//КонтрагентДебиторИНН
	//КонтрагентДебиторФактАдрес
	//ДоговораПроцентногоЗайма
	//ГенеральныйДиректор  
	//КонтрагентДебиторОГРН 
	//ДебеторскаяЗадолженностьСумма
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ     
	|	КорректировкаДолга.Организация КАК Организация, 
	|	КорректировкаДолга.Организация.НаименованиеПолное КАК ОрганизацияПН,   
	|	КорректировкаДолга.Организация.ИНН КАК ИНН,    
	|	КорректировкаДолга.Организация.ОГРН КАК ОГРН,
	|	КорректировкаДолга.Дата КАК Дата,
	|	КорректировкаДолга.Номер КАК Номер,
	|	КорректировкаДолга.Ссылка КАК Ссылка,
	|	КорректировкаДолга.КонтрагентДебитор.НаименованиеПолное КАК КонтрагентДебиторПН, 
	|	КорректировкаДолга.КонтрагентДебитор КАК КонтрагентДебитор,
	|	КорректировкаДолга.КонтрагентДебитор.ИНН КАК КонтрагентДебиторИНН,
	|	КорректировкаДолга.КонтрагентДебитор.РегистрационныйНомер КАК КонтрагентДебиторОГРН
	| ПОМЕСТИТЬ ДанныеСоглашения
	|ИЗ
	|	Документ.КорректировкаДолга КАК КорректировкаДолга
	|ГДЕ
	|	КорректировкаДолга.Ссылка В(&МассивДоговоров)
	|;
	|ВЫБРАТЬ                                
	|ДанныеСоглашения.Организация КАК Организация,
	|ДанныеСоглашения.ОрганизацияПН КАК ОрганизацияПН,
	|ДанныеСоглашения.ИНН КАК ИНН,
	|ДанныеСоглашения.ОГРН КАК ОГРН,
	|ДанныеСоглашения.Дата КАК Дата,
	|ДанныеСоглашения.Номер КАК Номер,
	|ДанныеСоглашения.КонтрагентДебиторПН КАК КонтрагентДебиторПН,  
	|ДанныеСоглашения.Ссылка КАК Ссылка, 
	|ДанныеСоглашения.КонтрагентДебитор КАК КонтрагентДебитор,
	|ДанныеСоглашения.КонтрагентДебиторИНН КАК КонтрагентДебиторИНН,
	|ДанныеСоглашения.КонтрагентДебиторОГРН КАК КонтрагентДебиторОГРН,
	|МАКСИМУМ(КонтактнаяИнформацияАдрес.Представление) КАК КонтрагентДебиторФактАдрес,
	|МАКСИМУМ(КонтактнаяИнформацияТелефон.Представление) КАК Телефон 
	//|ДанныеСоглашения.Ссылка КАК Ссылка,
	|ИЗ ДанныеСоглашения КАК ДанныеСоглашения    
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты.КонтактнаяИнформация КАК КонтактнаяИнформацияТелефон
	|		ПО ДанныеСоглашения.КонтрагентДебитор = КонтактнаяИнформацияТелефон.Ссылка
	|			И (КонтактнаяИнформацияТелефон.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.ТелефонКонтрагента))
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты.КонтактнаяИнформация КАК КонтактнаяИнформацияАдрес
	|		ПО ДанныеСоглашения.КонтрагентДебитор = КонтактнаяИнформацияАдрес.Ссылка
	|			И (КонтактнаяИнформацияАдрес.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.ФактАдресКонтрагента))
	|СГРУППИРОВАТЬ ПО
	|ДанныеСоглашения.Организация,
	|ДанныеСоглашения.ОрганизацияПН,
	|ДанныеСоглашения.ИНН,
	|ДанныеСоглашения.ОГРН,
	|ДанныеСоглашения.Дата,
	|ДанныеСоглашения.Номер,
	|ДанныеСоглашения.КонтрагентДебиторПН,  
	|ДанныеСоглашения.Ссылка, 
	|ДанныеСоглашения.КонтрагентДебитор,
	|ДанныеСоглашения.КонтрагентДебиторИНН,
	|ДанныеСоглашения.КонтрагентДебиторОГРН	
	|";
	
	Запрос.Параметры.Вставить("ДатаПечати", ТекущаяДата());
	Запрос.Параметры.Вставить("МассивДоговоров", МассивОбъектов);
	Результат =  Запрос.Выполнить().Выгрузить();  
	//Для каждого стр из Результат Цикл   
	//	//стр.КонтрагентДебиторФактАдрес = "";
	//КонецЦикла;
	
	Возврат ОбщегоНазначения.ТаблицаЗначенийВМассив(Результат);;
	
КонецФункции
// ~! Конец Французова 19.08.2024   (AUC-1985)


