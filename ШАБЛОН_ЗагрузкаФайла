 &НаСервере
Процедура ЗагрузитьСЭксел1НаСервере(АдресХранилища)
	ДвоичныеДанные = ПолучитьИзВременногоХранилища(АдресХранилища);
    ПолноеИмяФайла = ПолучитьИмяВременногоФайла("xlsx");
    ДвоичныеДанные.Записать(ПолноеИмяФайла);
	//Попытка
	//    ТабДок.Прочитать(ИмяФайла, СпособЧтенияЗначенийТабличногоДокумента.Текст);
	//    Возврат ТабДок;
	//Исключение
	//    Сообщить(ОписаниеОшибки());
	//    Возврат Неопределено;
	//КонецПопытки;
	
	
	
	
	//Объект.Состав.Очистить();
	
	//Вывод в табличный документ
	ТабличныйДокумент = Новый ТабличныйДокумент;
	ТабличныйДокумент.Прочитать(ПолноеИмяФайла , СпособЧтенияЗначенийТабличногоДокумента.Значение);
	
	//вывод в таблицу значений
	ПЗ = Новый ПостроительЗапроса;
	ПЗ.ИсточникДанных = Новый ОписаниеИсточникаДанных(ТабличныйДокумент.Область());
	ПЗ.ДобавлениеПредставлений = ТипДобавленияПредставлений.НеДобавлять;
	ПЗ.ЗаполнитьНастройки();
	ПЗ.Выполнить();
	
	ТаблицаЗначений = ПЗ.Результат.Выгрузить();	
	
	Спр = Справочники.ФизическиеЛица;
	Для Каждого Стр Из Объект.Состав Цикл
		Стр.КВыплате = 0;
		Сотр = ТаблицаЗначений.Найти(Стр.ФизическоеЛицо.Наименование, "Сотрудник");
		Если Сотр <> Неопределено Тогда 
			Стр.КВыплате = Сотр.Сумма;
			ТаблицаЗначений.Удалить(Сотр);
		КонецЕсли;
		ЗарплатаСтрокиСостава = Объект.Зарплата.НайтиСтроки(Новый Структура("ИдентификаторСтроки", Стр.ИдентификаторСтроки));
		ЗарплатаКадры.РазнестиСуммуПоБазе(Стр.КВыплате, ЗарплатаСтрокиСостава, "КВыплате",, Истина);
		
	КонецЦикла;
	
	Для Каждого Стр Из ТаблицаЗначений Цикл 
		Если Стр.Сумма <> 0 Тогда 
			Сообщить("Не найден в ведомости - "+Стр.Сотрудник);
		КонецЕсли;
	КонецЦикла;
	
	ТекСтр = Объект.Состав.Количество()-1;
	Пока ТекСтр>=0 Цикл
		Стр = Объект.Состав.Получить(ТекСтр);
		Если Стр.КВыплате = 0 Тогда 
			Для Каждого Стр1 Из Объект.Зарплата Цикл
				Если Стр1.ИдентификаторСтроки = Стр.ИдентификаторСтроки Тогда 
					Объект.Зарплата.Удалить(Стр1);
				КонецЕсли;
			КонецЦикла;
			Объект.Состав.Удалить(Стр);
			
		КонецЕсли;
		ТекСтр = ТекСтр - 1;
	КонецЦикла;
КонецПроцедуры

&НаКлиенте
Процедура ЗагрузитьСЭксел1(Команда) 
	 
	ПараметрыДиалога = Новый Структура;
	//ПараметрыДиалога.Вставить("Фильтр",НСтр("ru='Файл XML (*.xml)|*.xml'"));
	
	Оповещение = Новый ОписаниеОповещения("ЗагрузитьФайлЗавершение",ЭтотОбъект); 
	
	ПараметрыОбъекта = Новый Структура;
    ПараметрыОбъекта.Вставить("Объект",Объект);	  
	ПараметрыОбъекта.Вставить("ИмяФайла","");
	ОбменДаннымиКлиент.ОбработчикВыбораФайла(ПараметрыОбъекта, "ИмяФайла",Ложь,ПараметрыДиалога,Оповещение);
КонецПроцедуры   

&НаКлиенте
Процедура ЗагрузитьФайлЗавершение(Знач РезультатПомещенияФайлов, Знач ДополнительныеПараметры) Экспорт
	ДвоичныеДанные = Новый ДвоичныеДанные(РезультатПомещенияФайлов);
	АдресХранилища = ПоместитьВоВременноеХранилище(ДвоичныеДанные, УникальныйИдентификатор);
	ЗагрузитьСЭксел1НаСервере(АдресХранилища);
КонецПроцедуры

